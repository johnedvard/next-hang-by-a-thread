function t(t){return t&&t.__esModule?t.default:t}let e=()=>{};function i(t,e){let i=t.indexOf(e);if(-1!=i)return t.splice(i,1),!0}let s,n,a={};function o(t,e){a[t]=a[t]||[],a[t].push(e)}function h(t,e){a[t]=(a[t]||[]).filter((t=>t!=e))}function r(t,...e){(a[t]||[]).map((t=>t(...e)))}let l={get:(t,i)=>"_proxy"==i||e};function d(){return s}function c(){return n}function p(t,{contextless:e=!1}={}){if(s=document.getElementById(t)||t||document.querySelector("canvas"),e&&(s=s||new Proxy({},l)),!s)throw Error("You must provide a canvas element for the game");return n=s.getContext("2d")||new Proxy({},l),n.imageSmoothingEnabled=!1,r("init"),{canvas:s,context:n}}function u(t,e){let i=Math.sin(e),s=Math.cos(e);return{x:t.x*s-t.y*i,y:t.x*i+t.y*s}}function g(t,e,i){return Math.min(Math.max(t,i),e)}function y(t){let{x:e=0,y:i=0,width:s,height:n}=t.world||t;return t.mapwidth&&(s=t.mapwidth,n=t.mapheight),t.anchor&&(e-=s*t.anchor.x,i-=n*t.anchor.y),s<0&&(e+=s,s*=-1),n<0&&(i+=n,n*=-1),{x:e,y:i,width:s,height:n}}class m{constructor(t=0,e=0,i={}){this.x=t,this.y=e,i._c&&(this.clamp(i._a,i._b,i._d,i._e),this.x=t,this.y=e)}add(t){return new m(this.x+t.x,this.y+t.y,this)}subtract(t){return new m(this.x-t.x,this.y-t.y,this)}scale(t){return new m(this.x*t,this.y*t)}normalize(t=this.length()){return new m(this.x/t,this.y/t)}dot(t){return this.x*t.x+this.y*t.y}length(){return Math.hypot(this.x,this.y)}distance(t){return Math.hypot(this.x-t.x,this.y-t.y)}angle(t){return Math.acos(this.dot(t)/(this.length()*t.length()))}clamp(t,e,i,s){this._c=!0,this._a=t,this._b=e,this._d=i,this._e=s}get x(){return this._x}get y(){return this._y}set x(t){this._x=this._c?g(this._a,this._d,t):t}set y(t){this._y=this._c?g(this._b,this._e,t):t}}function x(){return new m(...arguments)}class v extends class{constructor(t){return this.init(t)}init(t={}){this.position=x(),this.velocity=x(),this.acceleration=x(),this.ttl=1/0,Object.assign(this,t)}update(t){this.advance(t)}advance(t){let e=this.acceleration;t&&(e=e.scale(t)),this.velocity=this.velocity.add(e);let i=this.velocity;t&&(i=i.scale(t)),this.position=this.position.add(i),this._pc(),this.ttl--}get dx(){return this.velocity.x}get dy(){return this.velocity.y}set dx(t){this.velocity.x=t}set dy(t){this.velocity.y=t}get ddx(){return this.acceleration.x}get ddy(){return this.acceleration.y}set ddx(t){this.acceleration.x=t}set ddy(t){this.acceleration.y=t}isAlive(){return this.ttl>0}_pc(){}}{init({width:t=0,height:e=0,context:i=c(),render:s=this.draw,update:n=this.advance,children:a=[],anchor:o={x:0,y:0},opacity:h=1,rotation:r=0,scaleX:l=1,scaleY:d=1,...p}={}){this._c=[],super.init({width:t,height:e,context:i,anchor:o,opacity:h,rotation:r,scaleX:l,scaleY:d,...p}),this._di=!0,this._uw(),this.addChild(a),this._rf=s,this._uf=n}update(t){this._uf(t),this.children.map((e=>e.update&&e.update(t)))}render(){let t=this.context;t.save(),(this.x||this.y)&&t.translate(this.x,this.y),this.rotation&&t.rotate(this.rotation),1==this.scaleX&&1==this.scaleY||t.scale(this.scaleX,this.scaleY);let e=-this.width*this.anchor.x,i=-this.height*this.anchor.y;(e||i)&&t.translate(e,i),this.context.globalAlpha=this.opacity,this._rf(),(e||i)&&t.translate(-e,-i),this.children.map((t=>t.render&&t.render())),t.restore()}draw(){}_pc(){this._uw(),this.children.map((t=>t._pc()))}get x(){return this.position.x}get y(){return this.position.y}set x(t){this.position.x=t,this._pc()}set y(t){this.position.y=t,this._pc()}get width(){return this._w}set width(t){this._w=t,this._pc()}get height(){return this._h}set height(t){this._h=t,this._pc()}_uw(){if(!this._di)return;let{_wx:t=0,_wy:e=0,_wo:i=1,_wr:s=0,_wsx:n=1,_wsy:a=1}=this.parent||{};this._wx=this.x,this._wy=this.y,this._ww=this.width,this._wh=this.height,this._wo=i*this.opacity,this._wsx=n*this.scaleX,this._wsy=a*this.scaleY,this._wx=this._wx*n,this._wy=this._wy*a,this._ww=this.width*this._wsx,this._wh=this.height*this._wsy,this._wr=s+this.rotation;let{x:o,y:h}=u({x:this._wx,y:this._wy},s);this._wx=o,this._wy=h,this._wx+=t,this._wy+=e}get world(){return{x:this._wx,y:this._wy,width:this._ww,height:this._wh,opacity:this._wo,rotation:this._wr,scaleX:this._wsx,scaleY:this._wsy}}set children(t){this.removeChild(this._c),this.addChild(t)}get children(){return this._c}addChild(...t){t.flat().map((t=>{this.children.push(t),t.parent=this,t._pc=t._pc||e,t._pc()}))}removeChild(...t){t.flat().map((t=>{i(this.children,t)&&(t.parent=null,t._pc())}))}get opacity(){return this._opa}set opacity(t){this._opa=t,this._pc()}get rotation(){return this._rot}set rotation(t){this._rot=t,this._pc()}setScale(t,e=t){this.scaleX=t,this.scaleY=e}get scaleX(){return this._scx}set scaleX(t){this._scx=t,this._pc()}get scaleY(){return this._scy}set scaleY(t){this._scy=t,this._pc()}}class f extends v{init({image:t,width:e=(t?t.width:void 0),height:i=(t?t.height:void 0),...s}={}){super.init({image:t,width:e,height:i,...s})}get animations(){return this._a}set animations(t){let e,i;for(e in this._a={},t)this._a[e]=t[e].clone(),i=i||this._a[e];this.currentAnimation=i,this.width=this.width||i.width,this.height=this.height||i.height}playAnimation(t){this.currentAnimation=this.animations[t],this.currentAnimation.loop||this.currentAnimation.reset()}advance(t){super.advance(t),this.currentAnimation&&this.currentAnimation.update(t)}draw(){this.image&&this.context.drawImage(this.image,0,0,this.image.width,this.image.height),this.currentAnimation&&this.currentAnimation.render({x:0,y:0,width:this.width,height:this.height,context:this.context}),this.color&&(this.context.fillStyle=this.color,this.context.fillRect(0,0,this.width,this.height))}}function w(){return new f(...arguments)}let b=new WeakMap,A={},C={},_={0:"left",1:"middle",2:"right"};function k(t,e){let{x:i,y:s,width:n,height:a}=y(t);do{i-=t.sx||0,s-=t.sy||0}while(t=t.parent);let o=e.x-Math.max(i,Math.min(e.x,i+n)),h=e.y-Math.max(s,Math.min(e.y,s+a));return o*o+h*h<e.radius*e.radius}function E(t){let e=t._lf.length?t._lf:t._cf;for(let i=e.length-1;i>=0;i--){let s=e[i];if(s.collidesWithPointer?s.collidesWithPointer(t):k(s,t))return s}}function L(t,e){return parseFloat(t.getPropertyValue(e))||0}function S(t){let e=null!=t.button?_[t.button]:"left";C[e]=!0,N(t,"onDown")}function B(t){let e=null!=t.button?_[t.button]:"left";C[e]=!1,N(t,"onUp")}function D(t){N(t,"onOver")}function M(t){b.get(t.target)._oo=null,C={}}function I(t,e,i){let s=E(t);s&&s[e]&&s[e](i),A[e]&&A[e](i,s),"onOver"==e&&(s!=t._oo&&t._oo&&t._oo.onOut&&t._oo.onOut(i),t._oo=s)}function N(t,e){t.preventDefault();let i=t.target,s=b.get(i),{scaleX:n,scaleY:a,offsetX:o,offsetY:h}=function(t){let{canvas:e,_s:i}=t,s=e.getBoundingClientRect(),n="none"!=i.transform?i.transform.replace("matrix(","").split(","):[1,1,1,1],a=parseFloat(n[0]),o=parseFloat(n[3]),h=(L(i,"border-left-width")+L(i,"border-right-width"))*a,r=(L(i,"border-top-width")+L(i,"border-bottom-width"))*o,l=(L(i,"padding-left")+L(i,"padding-right"))*a,d=(L(i,"padding-top")+L(i,"padding-bottom"))*o;return{scaleX:(s.width-h-l)/e.width,scaleY:(s.height-r-d)/e.height,offsetX:s.left+(L(i,"border-left-width")+L(i,"padding-left"))*a,offsetY:s.top+(L(i,"border-top-width")+L(i,"padding-top"))*o}}(s);t.type.includes("touch")?(Array.from(t.touches).map((({clientX:t,clientY:e,identifier:i})=>{let r=s.touches[i];r||(r=s.touches[i]={start:{x:(t-o)/n,y:(e-h)/a}},s.touches.length++),r.changed=!1})),Array.from(t.changedTouches).map((({clientX:i,clientY:l,identifier:d})=>{let c=s.touches[d];c.changed=!0,c.x=s.x=(i-o)/n,c.y=s.y=(l-h)/a,I(s,e,t),r("touchChanged",t,s.touches),"onUp"==e&&(delete s.touches[d],s.touches.length--,s.touches.length||r("touchEnd"))}))):(s.x=(t.clientX-o)/n,s.y=(t.clientY-h)/a,I(s,e,t))}function P({radius:t=5,canvas:e=d()}={}){let i=b.get(e);if(!i){let s=window.getComputedStyle(e);i={x:0,y:0,radius:t,touches:{length:0},canvas:e,_cf:[],_lf:[],_o:[],_oo:null,_s:s},b.set(e,i)}return e.addEventListener("mousedown",S),e.addEventListener("touchstart",S),e.addEventListener("mouseup",B),e.addEventListener("touchend",B),e.addEventListener("touchcancel",B),e.addEventListener("blur",M),e.addEventListener("mousemove",D),e.addEventListener("touchmove",D),i._t||(i._t=!0,o("tick",(()=>{i._lf.length=0,i._cf.map((t=>{i._lf.push(t)})),i._cf.length=0}))),i}function R(t,e){let i=t[0].toUpperCase()+t.substr(1);A["on"+i]=e}function F(t){let e=t[0].toUpperCase()+t.substr(1);A["on"+e]=0}function z(t){let e=t.canvas;t.clearRect(0,0,e.width,e.height)}function T({fps:t=60,clearCanvas:i=!0,update:s=e,render:n,context:a=c(),blur:o=!1}={}){if(!n)throw Error("You must provide a render() function");let h,l,d,p,u,g=0,y=1e3/t,m=1/t,x=i?z:e,v=!0;function f(){if(l=requestAnimationFrame(f),v&&(d=performance.now(),p=d-h,h=d,!(p>1e3))){for(r("tick"),g+=p;g>=y;)u.update(m),g-=y;x(a),u.render()}}return o||(window.addEventListener("focus",(()=>{v=!0})),window.addEventListener("blur",(()=>{v=!1}))),u={update:s,render:n,isStopped:!0,start(){h=performance.now(),this.isStopped=!1,requestAnimationFrame(f)},stop(){this.isStopped=!0,cancelAnimationFrame(l)},_frame:f,set _last(t){h=t}},u}let X=[],Y={},O={},j={0:"south",1:"east",2:"west",3:"north",4:"leftshoulder",5:"rightshoulder",6:"lefttrigger",7:"righttrigger",8:"select",9:"start",10:"leftstick",11:"rightstick",12:"dpadup",13:"dpaddown",14:"dpadleft",15:"dpadright"};function G(t){X[t.gamepad.index]={pressedButtons:{},axes:{}}}function W(t){delete X[t.gamepad.index]}function U(){X.map((t=>{t.pressedButtons={},t.axes={}}))}function V(){let t=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads:[];for(let e=0;e<t.length;e++){let i=t[e];if(!i)continue;i.buttons.map(((t,e)=>{let s=j[e],{pressed:n}=t,{pressedButtons:a}=X[i.index],o=a[s];!o&&n?[Y[i.index],Y].map((e=>{e?.[s]?.(i,t)})):o&&!n&&[O[i.index],O].map((e=>{e?.[s]?.(i,t)})),a[s]=n}));let{axes:s}=X[i.index];s.leftstickx=i.axes[0],s.leftsticky=i.axes[1],s.rightstickx=i.axes[2],s.rightsticky=i.axes[3]}}function Q(){window.addEventListener("gamepadconnected",G),window.addEventListener("gamepaddisconnected",W),window.addEventListener("blur",U),o("tick",V)}function J(t,e,{gamepad:i,handler:s="gamepaddown"}={}){let n="gamepaddown"==s?Y:O;[].concat(t).map((t=>{isNaN(i)?n[t]=e:(n[i]=n[i]||{},n[i][t]=e)}))}function H(t,{gamepad:e,handler:i="gamepaddown"}={}){let s="gamepaddown"==i?Y:O;[].concat(t).map((t=>{isNaN(e)?delete s[t]:(s[e]=s[e]||{},delete s[e][t])}))}function K(t,{gamepad:e}={}){return isNaN(e)?X.some((e=>e.pressedButtons[t])):!!X[e]&&!!X[e].pressedButtons[t]}let q,Z={},$=!1,tt={swipe:{touches:1,threshold:10,touchend({0:t}){let e=t.x-t.start.x,i=t.y-t.start.y,s=Math.abs(e),n=Math.abs(i);if(!(s<this.threshold&&n<this.threshold))return s>n?e<0?"left":"right":i<0?"up":"down"}},pinch:{touches:2,threshold:2,touchstart({0:t,1:e}){this.prevDist=Math.hypot(t.x-e.x,t.y-e.y)},touchmove({0:t,1:e}){let i=Math.hypot(t.x-e.x,t.y-e.y);if(Math.abs(i-this.prevDist)<this.threshold)return;let s=i>this.prevDist?"out":"in";return this.prevDist=i,s}}};function et(){$||($=!0,o("touchChanged",((t,e)=>{Object.keys(tt).map((i=>{let s,n=tt[i];(!q||q==i)&&e.length==n.touches&&[...Array(e.length).keys()].every((t=>e[t]))&&(s=n[t.type]?.(e)??"")&&Z[i+s]&&(q=i,Z[i+s](t,e))}))})),o("touchEnd",(()=>{q=0})))}function it(t,e){[].concat(t).map((t=>{Z[t]=e}))}function st(t){[].concat(t).map((t=>{Z[t]=0}))}let nt={},at={},ot={},ht={Enter:"enter",Escape:"esc",Space:"space",ArrowLeft:"arrowleft",ArrowUp:"arrowup",ArrowRight:"arrowright",ArrowDown:"arrowdown"};function rt(t=e,i){t._pd&&i.preventDefault(),t(i)}function lt(t){let e=ht[t.code],i=nt[e];ot[e]=!0,rt(i,t)}function dt(t){let e=ht[t.code],i=at[e];ot[e]=!1,rt(i,t)}function ct(){ot={}}function pt(){let t;for(t=0;t<26;t++)ht["Key"+String.fromCharCode(t+65)]=String.fromCharCode(t+97);for(t=0;t<10;t++)ht["Digit"+t]=ht["Numpad"+t]=""+t;window.addEventListener("keydown",lt),window.addEventListener("keyup",dt),window.addEventListener("blur",ct)}function ut(t,e,{handler:i="keydown",preventDefault:s=!0}={}){let n="keydown"==i?nt:at;e._pd=s,[].concat(t).map((t=>n[t]=e))}function gt(t,{handler:e="keydown"}={}){let i="keydown"==e?nt:at;[].concat(t).map((t=>delete i[t]))}function yt(t){return!!ot[t]}function mt(t,e){return Object.values(e).includes(t)}function xt(t){return Object.keys(tt).some((e=>t.startsWith(e)))}function vt(t={}){pt();let e=P(t.pointer);return et(),Q(),{pointer:e}}function ft(t,e,{gamepad:i,key:s}={}){[].concat(t).map((t=>{if(mt(t,j))J(t,e,i);else if(xt(t))it(t,e);else if(mt(t,ht))ut(t,e,s);else{if(!["down","up"].includes(t))throw new TypeError(`"${t}" is not a valid input name`);R(t,e)}}))}function wt(t,{gamepad:e,key:i}={}){[].concat(t).map((t=>{mt(t,j)?H(t,e):xt(t)?st(t):mt(t,ht)?gt(t,i):["down","up"].includes(t)&&F(t)}))}class bt{constructor({create:t,maxSize:e=1024}={}){let i;if(!t||!(i=t())||!(i.update&&i.init&&i.isAlive&&i.render))throw Error("Must provide create() function which returns an object with init(), update(), render(), and isAlive() functions");this._c=t,this.objects=[t()],this.size=0,this.maxSize=e}get(t={}){if(this.size==this.objects.length){if(this.size==this.maxSize)return;for(let t=0;t<this.size&&this.objects.length<this.maxSize;t++)this.objects.push(this._c())}let e=this.objects[this.size];return this.size++,e.init(t),e}getAliveObjects(){return this.objects.slice(0,this.size)}clear(){this.size=this.objects.length=0,this.objects.push(this._c())}update(t){let e,i=!1;for(let s=this.size;s--;)e=this.objects[s],e.update(t),e.isAlive()||(i=!0,this.size--);i&&this.objects.sort(((t,e)=>e.isAlive()-t.isAlive()))}render(){for(let t=this.size;t--;)this.objects[t].render()}}function At(){return new bt(...arguments)}const Ct=(t,e,i)=>{let s=Math.max(0,Math.min(1,(i-t)/(e-t)));return s*s*s*(s*(6*s-15)+10)},_t=({behavior:t,direction:e,distance:i,orgX:s,orgY:n,x:a,y:o,dt:h})=>{let r="",l=1,d=e;const c=s-i,p=s+i,u=n-i,g=n+i;switch(t){case"ns":r="y";break;case"ew":r="x"}let y={x:Ct(c,p,a),y:Ct(u,g,o)};switch(e){case"n":l=-1,y.y<.05&&(d="s");break;case"s":l=1,y.y>.95&&(d="n");break;case"e":l=1,y.x>.95&&(d="w");break;case"w":l=-1,y.x<.05&&(d="e")}return a>s&&(y.x=Math.abs(1-y.x)),o>n&&(y.y=Math.abs(1-y.y)),y.x=y.x*l*5,y.y=y.y*l*5,{axis:r,newDirection:d,smoothSpeed:y}},kt=(t,e)=>{let i="";return i=e<0?"ew"===t?"w":"n":"ew"===t?"e":"s",i};class Et{x;y;level;width=32;height=32;speed=1;phase=1-2*Math.random();waveDir=1;constructor(t,e,{level:i,behavior:s,distance:n}){this.direction=kt(s,n),this.distance=Math.abs(n),this.behavior=s,this.orgX=t,this.orgY=e,this.x=t,this.y=e,this.level=i}getSmallCollisionBox(){return{x:this.x+10,y:this.y+10,width:12,height:12}}update(t){const{axis:e,newDirection:i,smoothSpeed:s}=_t({behavior:this.behavior,distance:this.distance,direction:this.direction,x:this.x,y:this.y,orgX:this.orgX,orgY:this.orgY,dt:t});this.direction=i,this[e]+=this.speed*s[e],this.updateWaterBlur(t)}updateWaterBlur(t){this.phase<=-2?this.waveDir=1:this.phase>=2&&(this.waveDir=-1),this.phase+=t*this.waveDir*3}render(t){t&&(t.lineWidth=4,t.beginPath(),t.moveTo(this.x,this.y),t.quadraticCurveTo(this.x+2*this.phase,this.y+this.height/4+Math.abs(5*this.phase),this.x,this.y+this.height),t.moveTo(this.x+this.width,this.y),t.quadraticCurveTo(this.x+ +this.width+2*this.phase,this.y+this.height/4+Math.abs(5*this.phase),this.x+this.width,this.y+this.height),t.moveTo(this.x+this.phase/5,this.y),t.lineTo(this.x+this.phase/5+this.width,this.y),t.moveTo(this.x+this.phase/5,this.y+this.height),t.lineTo(this.x+this.phase/5+this.width,this.y+this.height),t.stroke())}}const Lt=t=>{const e=document.getElementById("hint");switch(e.textContent="",t){case 1:e.textContent='Reach the goal below. \nCut the rope with "S".';break;case 2:e.textContent='Use the arrow keys to move.\n Use "Space" to boost up.';break;case 3:e.textContent=""}};let St=0,Bt=0;const Dt={};let Mt={},It=!1;const Nt={},Pt=({id:t,data:e,img:i})=>{Dt[t]={data:e,img:i}};let Rt=!1;const Ft=()=>{const t=document.querySelector("#hang-by-a-thread #wrap");window.innerHeight<window.innerWidth?(t.classList.add("autoWidth"),t.classList.remove("autoHeight")):(t.classList.add("autoHeight"),t.classList.remove("autoWidth"))},zt=(t,e)=>!(!t||!e)&&(t.x<e.x+e.width&&t.x+t.width>e.x&&t.y<e.y+e.height&&t.height+t.y>e.y),Tt=(t,e,i,s)=>{const n=(e.x-t.x)*(s.y-i.y)-(e.y-t.y)*(s.x-i.x);if(0===n)return null;const a=((i.x-t.x)*(s.y-i.y)-(i.y-t.y)*(s.x-i.x))/n,o=((i.x-t.x)*(e.y-t.y)-(i.y-t.y)*(e.x-t.x))/n;if(a<0||a>1)return null;if(o<0||o>1)return null;const h=t.x+a*(e.x-t.x),r=t.y+a*(e.y-t.y);return Number.isNaN(h)||Number.isNaN(r)?null:x(h,r)},Xt=(t,e)=>!!e.find((e=>e.token_id.split(":")[0]===t)),Yt=({x:t,y:e,scale:i,imgSrc:s})=>new Promise((n=>{const a=new Image;a.src=s,a.onload=()=>{const s=w({x:t,y:e,anchor:{x:.5,y:.5},width:8,height:8,image:a,scaleX:i,scaleY:i});n(s)}})),Ot=t=>new Promise((e=>{window.nearApi&&e();const i=document.createElement("script");i.onload=()=>{e()},i.src=t,document.head.appendChild(i)})),jt=(t,...e)=>Gt(t,zzfxG(...e)),Gt=(t,...e)=>{let i=t.createBufferSource(),s=t.createBuffer(e.length,e[0].length,44100);return e.map(((t,e)=>s.getChannelData(e).set(t))),i.buffer=s,i.connect(t.destination),i.start(),i},Wt=(t,e,i,s=125)=>{let n,a,o,h,r,l,d,c,p,u,g,y,m,x,v,f=0,w=[],b=[],A=[],C=0,_=0,k=1,E={},L=window.zzfxR/s*60>>2;for(;k;C++)w=[k=c=g=m=0],i.map(((s,g)=>{for(d=e[s][C]||[0,0,0],k|=!!e[s][C],v=m+(e[s][0].length-2-!c)*L,x=g==i.length-1,a=2,h=m;a<d.length+x;c=++a){for(r=d[a],p=a==d.length+x-1&&x||u!=(d[0]||0)|r|0,o=0;o<L&&c;o++>L-99&&p&&(y+=(y<1)/99))l=(1-y)*w[f++]/2||0,b[h]=(b[h]||0)-l*_+l,A[h]=(A[h++]||0)+l*_+l;r&&(y=r%1,_=d[1]||0,(r|=0)&&(w=E[[u=d[f=0]||0,r]]=E[[u,r]]||(n=[...t[u]],n[2]*=2**((r-12)/12),r>0?window.zzfxG(...n):[])))}m=v}));return[b,A]};let Ut,Vt=!1,Qt=null,Jt=!1;const Ht=()=>{"undefined"!=typeof window&&(window.sfxContext=new(window.AudioContext||webkitAudioContext),window.zzfxR=44100,window.zzfxX=new(window.AudioContext||webkitAudioContext),window.zzfxG=(t=1,e=.05,i=220,s=0,n=0,a=.1,o=0,h=1,r=0,l=0,d=0,c=0,p=0,u=0,g=0,y=0,m=0,x=1,v=0,f=0)=>{let w,b,A=2*Math.PI,C=r*=500*A/44100**2,_=(0<g?1:-1)*A/4,k=i*=(1+2*e*Math.random()-e)*A/44100,E=[],L=0,S=0,B=0,D=1,M=0,I=0,N=0;for(l*=500*A/44100**3,g*=A/44100,d*=A/44100,c*=44100,p=44100*p|0,b=(s=99+44100*s)+(v*=44100)+(n*=44100)+(a*=44100)+(m*=44100)|0;B<b;E[B++]=N)++I%(100*y|0)||(N=o?1<o?2<o?3<o?Math.sin((L%A)**3):Math.max(Math.min(Math.tan(L),1),-1):1-(2*L/A%2+2)%2:1-4*Math.abs(Math.round(L/A)-L/A):Math.sin(L),N=(p?1-f+f*Math.sin(2*Math.PI*B/p):1)*(0<N?1:-1)*Math.abs(N)**h*t*.3*(B<s?B/s:B<s+v?1-(B-s)/v*(1-x):B<s+v+n?x:B<b-m?(b-B-m)/a*x:0),N=m?N/2+(m>B?0:(B<b-m?1:(b-B)/m)*E[B-m|0]/2):N),w=(i+=r+=l)*Math.sin(S*g-_),L+=w-w*u*(1-1e9*(Math.sin(B)+1)%2),S+=w-w*u*(1-1e9*(Math.sin(B)**2+1)%2),D&&++D>c&&(i+=d,k+=d,D=0),!p||++M%p||(i=k,r=C,D=D||1);return E}),"undefined"!=typeof window&&(Ut=window.zzfxX)},Kt=()=>Vt,qt=()=>Jt,Zt=()=>{Jt=!1,Ut.suspend()},$t=()=>{if(Jt=!0,Qt)return void Ut.resume();let t=Wt(...[[[.5,0,245,.07,.1,.65,,1.5,,,,,,,,,,,.05,1],[.3,0,245,,,3,2,.3,,-.001,,,,,,,.02,,,.04],[.1,0,245,,,2,1,0],[,0,,,,,4,,,,,,,,100,2]],[[[,,10,,,,17,,,,24,,,,25,,,,24,,,,17,,,,10,,,,17,,,,24,,,,25,,,,24,,,,17,,,,10,,,,17,,,,24,,,,25,,,,24,,,,17,,,,],[1,,22.1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,],[2,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,]],[[,,18,,,,22,,,,25,,,,29,,,,25,,,,22,,,,18,,,,22,,,,25,,,,29,,,,25,,,,22,,,,],[1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,],[2,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,]],[[,,10,,,,17,,,,24,,,,25,,,,24,,,,17,,,,10,,,,17,,,,24,,,,25,,,,24,,,,17,,,,10,,,,17,,,,24,,,,25,,,,24,,,,17,,,,],[1,,25,,,,,,,,,,,,,,,,,,,,,,24,,25,,,,,,,,,,,,29,,,,,,,,,,,,28,,,,,,,,,,,,,,,,,,,,,,,,],[2,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,]],[[,,18,,,,22,,,,25,,,,29,,,,25,,,,22,,,,18,,,,22,,,,25,,,,29,,,,25,,,,22,,,,],[1,,18,,,,,,,,,,,,,,,,,,,,,,17,,18,,,,,,,,,,,,23,,,,,,,,,,,,],[2,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,]],[[,,10,,,,17,,,,24,,,,25,,,,24,,,,17,,,,10,,,,17,,,,24,,,,25,,,,24,,,,17,,,,10,,,,17,,,,24,,,,25,,,,24,,,,17,,,,],[1,,22,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,],[2,,10.53,,,,,,,,,,,,,,,,,,,,12.4,,,,13.7,,,,,,,,,,,,20,,,,,,,,,,,,18,,,,,,,,,,,,,,,,,,,,17,,,,]],[[,,18,,,,22,,,,25,,,,29,,,,25,,,,22,,,,18,,,,22,,,,25,,,,29,,,,25,,,,22,,,,],[1,,18,,,,,,,,,,,,,,,,,,,,,,17,,18,,,,,,,,,,,,23.1,,,,,,,,,,,,],[2,,6,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,-1]]],[0,1,2,3,4,5],,{title:"",instruments:["","","",""],patterns:["A1","A2","B1","B2","B3","B4"]}]);Qt=Gt(window.zzfxX,...t),Qt.loop=!0};class te{level;scale=1;width=60;height=32;originalRadius={x:15,y:30};radiusX=15;radiusY=30;hasWon=!1;hasVanished=!1;vanishSpeed=.3;isVanishihng=!1;constructor(t,e,{level:i}){this.x=t,this.y=e,this.level=i}update(){this.hasVanished||this.checkCollision()}render(t){t&&!this.hasVanished&&(t.lineWidth=4,t.beginPath(),this.hasWon&&this.startVanishing(),t.ellipse(this.x+this.width/2,this.y+this.height/2,this.radiusX,this.radiusY,Math.PI/2,0,2*Math.PI),t.stroke())}startVanishing(){this.isVanishihng||jt(window.sfxContext,...[,,269,.07,.21,.3,1,.94,8.3,-.2,284,.12,.12,,,,.13,.75,.17]),this.isVanishihng=!0,this.radiusX-=this.vanishSpeed,this.radiusY-=2*this.vanishSpeed,this.radiusX<=0&&(this.radiusX=0),this.radiusY<=0&&(this.radiusY=0),this.radiusX<=0&&this.radiusY<=0&&(this.hasVanished=!0,r("l"))}checkCollision(){if(zt({x:this.x,y:this.y,width:this.width,height:this.height},this.level.player.sprite)){if(this.hasWon)return;r("g"),this.hasWon=!0}}}const ee={level1:{p:{x:400,y:255},r:30,s:[],b:[{x:272,y:220},{x:303,y:220},{x:333,y:220},{x:363,y:220},{x:393,y:220},{x:423,y:220},{x:453,y:220},{x:483,y:220},{x:453,y:300},{x:303,y:300}],g:[{x:370,y:600}]},level2:{p:{x:416,y:255},r:30,s:[],b:[{x:400,y:220},{x:302,y:360},{x:332,y:360},{x:462,y:360},{x:492,y:360}],g:[{x:388,y:86}]},level3:{p:{x:272,y:255},r:30,s:[{x:464,y:350,b:"ew",d:100}],b:[{x:260,y:220}],g:[{x:400,y:600}]},level4:{p:{x:416,y:155},r:30,s:[{x:416,y:374,b:"ew",d:70},{x:346,y:220}],b:[{x:400,y:120},{x:480,y:260},{x:480,y:290},{x:480,y:322},{x:480,y:354},{x:480,y:384},{x:480,y:414},{x:330,y:260},{x:330,y:290},{x:330,y:322},{x:330,y:354},{x:330,y:384},{x:330,y:414},{x:360,y:414},{x:390,y:414},{x:420,y:414},{x:450,y:414},{x:200,y:630,b:"ew",d:70}],g:[{x:200,y:690}]},level5:{p:{x:236,y:308,b:"ns",d:200},r:33,s:[{x:400,y:380},{x:400,y:480},{x:400,y:580}],b:[{x:220,y:275,b:"ns",d:200}],g:[{x:660,y:700}]},level6:{p:{x:272,y:255},r:30,s:[{x:300,y:400,b:"ew",d:100},{x:464,y:350,b:"ew",d:-200},{x:100,y:450,b:"ew",d:100}],b:[{x:260,y:220},{x:460,y:290},{x:460,y:322},{x:460,y:354}],g:[{x:600,y:700}]}},ie=Object.keys(ee).length;const se=(t,e)=>{try{localStorage.setItem(t,e)}catch(t){console.error(t)}},ne=t=>{try{return localStorage.getItem(t)}catch(t){console.error(t)}};async function ae(t){const e="https://api.arcadians.io/"+t;return new Promise(((i,s)=>{var n=new XMLHttpRequest;n.onload=()=>{if(n.readyState===n.DONE){200!==n.status&&s(null);let o="female";var e=JSON.parse(n.response);const h=e.attributes.find((t=>"Head"===t.trait_type));e.attributes.find((t=>"Class"===t.trait_type)).value.match("Male")&&(o="male");const r=h.value.toLowerCase().replaceAll(" ","-");var a=new Image;a.src=`https://nftstorage.link/ipfs/bafybeib2ir3zpgd3cmizcv7shekjeftcwq7apjib6i5gz2sjc4vajwtgiy/${o}/head/${r}.png`,a.addEventListener("error",(t=>{console.log("err",t),s(null)}),!1),a.addEventListener("load",(()=>{se("Arcadian #"+t,a),Pt({id:t,data:e,img:a}),i({id:t,data:e,img:a})}),!1)}},n.open("GET",e),n.send()}))}let oe;const he=()=>Ot("https://sdk.crazygames.com/crazygames-sdk-v1.js"),re=()=>{r("adPlaying",{})},le=()=>{r("adFinished",{})},de=()=>{r("adFinished",{})},ce=()=>{oe?.addEventListener("adStarted",re),oe?.addEventListener("adFinished",le),oe?.addEventListener("adError",de)};let pe;const ue=()=>Ot("https://game-cdn.poki.com/scripts/v2/poki-sdk.js");let ge,ye;const me=()=>{(location.href.match("crazygames")?he().then((()=>(oe=window.CrazyGames.CrazySDK.getInstance(),oe.init(),ce(),oe))):Promise.reject()).then((t=>{ye=t,console.log("crazyGameSdk",ye)})),(location.href.match("poki")?ue().then((()=>(pe=window.PokiSDK,pe.init().then((()=>(console.log("Poki SDK successfully initialized"),pe.gameLoadingFinished(),pe))).catch((()=>(console.log("Initialized, but the user likely has adblock"),null)))))):Promise.reject(null)).then((t=>{ge=t,console.log("pokiSdk",ge)})),ve(),xe()},xe=()=>{o("adPlaying",fe),o("adFinished",we)},ve=()=>{o("g",be),o("clickHamburger",Ae),o("s",Ce),o("x",Ce)},fe=()=>{_e()},we=()=>{ke()},be=()=>{Le()},Ae=()=>{Le()},Ce=()=>{Ee()},_e=()=>{Kt()&&qt()&&Zt()},ke=()=>{Kt()&&!qt()&&$t()},Ee=()=>{ye?.gameplayStart(),ge?.gameplayStart()},Le=()=>{ye?.gameplayStop(),ge?.gameplayStop()},Se=["main","bonus","levels","level-dialog","near-levels","thanks"];let Be=!1,De=!0;const Me=()=>{document.getElementById("select-level-btn").focus()},Ie=({nftTokensBySeries:t,nftTokensForOwner:e,nftCollections:i})=>{const s=document.getElementById("loading-near-levels");s&&s.remove();const n=document.getElementById("near-levels-grid");i.forEach((t=>{var i,s;i=t.token_series_id,s=t.metadata.description,Nt[i]=s;const a=document.createElement("button"),o=document.createElement("img"),h=Xt(t.token_series_id,e);o.setAttribute("src","https://ipfs.fleek.co/ipfs/"+t.metadata.media),a.setAttribute("near","true"),h||a.classList.add("disabled"),a.setAttribute("token-series-id",t.token_series_id),a.setAttribute("price","1000000000000000000000000"),a.textContent=t.metadata.title,a.appendChild(o);const r=document.createElement("span");r.textContent=h?"Click to play level":"Buy level for: "+(t.price/Math.pow(10,24)).toFixed(2)+" Ⓝ",a.appendChild(r),a.classList.add("level-item"),n.appendChild(a)}))},Ne=()=>{const t=document.getElementById("bonus-grid");Pe(t),Re(t)},Pe=e=>{const i=new Image;i.src=t("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAIBAMAAAA2IaO4AAAAAXNSR0IArs4c6QAAABJQTFRF9u3NAAAA6e%2FsoKCLVVVoIR4gJR%2FcEQAAAAJ0Uk5TAAB2k804AAAAK0lEQVR42mMQDA1lZBBVUgpkCFJSUmUIClUNZQgKVjWFcEWdVAIYBENDBQGBlgaUUfu3rwAAAABJRU5ErkJggg%3D%3D"),new Promise((t=>{const e=[];e.push(ae(92)),e.push(ae(101)),e.push(ae(110)),e.push(ae(104));for(let t=1;t<22;t++){if(2===t||13===t)continue;const i=ae(t);e.push(i)}Promise.allSettled(e).then((e=>{t(e)}))})).then((t=>{for(let s=0;s<t.length;s++){if("fulfilled"!==t[s].status)continue;const n=t[s].value.img,a=document.createElement("canvas");a.setAttribute("height",4*n.height),a.setAttribute("width",4*n.width),a.classList.add("bonus-item"),a.setAttribute("arcadian",t[s].value.id),s>5&&!It&&a.classList.add("disabled");const o=a.getContext("2d");o.imageSmoothingEnabled=!1,o.scale(8,8),o.drawImage(i,n.width/4-4,n.height/4-12),o.scale(.5,.5),o.drawImage(n,0,0),e.appendChild(a)}}))},Re=t=>{t.addEventListener("click",(t=>{var e;t.target.classList.contains("bonus-item")&&(t.target.classList.contains("disabled")||(e=t.target.getAttribute("arcadian"),Mt=Dt[e],r("i",{img:Mt.img}),Xe("main")))}))},Fe=()=>{document.getElementById("wrap").addEventListener("click",ze)},ze=t=>{const e=t.target.id,i=t.target.classList;switch(e){case"select-level-btn":(()=>{const t=document.getElementById("levels-grid");t.innerHTML="";for(let e=1;e<ie+1;e++){const i=document.createElement("button");i.textContent=e,i.classList.add("level-item"),t.appendChild(i)}})(),Xe("levels"),document.getElementsByClassName("level-item")[0].focus();break;case"bonus-content-btn":Xe("bonus");break;case"hamburger":r("clickHamburger"),Xe("main");break;case"near-level-btn":Xe("near-levels");break;case"next-btn":Xe(),r("x");break;case"replay-btn":Xe(),r("r");break;case"music-btn":r("t")}if(i.contains("inverse"))return void Xe("main");const s=t.target.closest("button");s&&s.getAttribute("near")?Te(s):s&&s.classList.contains("level-item")&&(Xe(),r("s",{levelId:+s.textContent}))},Te=t=>{if(t&&t.classList.contains("disabled")){Je();r("b",{token_series_id:t.getAttribute("token-series-id"),priceInYoctoNear:t.getAttribute("price")})}else Xe(),r("s",{levelData:JSON.parse((e=t.getAttribute("token-series-id"),Nt[e]))});var e},Xe=t=>{De=!!t,r("levelQuit",{}),Lt(null),Se.forEach((e=>{const i=document.getElementById(e);i.classList.contains("hide")||i.classList.add("hide"),e===t&&i.classList.remove("hide")}))},Ye=()=>{o("loginNear",Oe),o("logoutNear",je)},Oe=()=>{Je()},je=()=>{const t=document.getElementById("near-level-btn");t.classList.add("disabled"),t.setAttribute("disabled","true")},Ge=()=>{o("l",Ue),o("n",Ve),o("p",Qe),o("t",We)},We=()=>{document.getElementById("music-btn").textContent=qt()?"Music is ON":"Music is OFF"},Ue=()=>{Xe("level-dialog"),document.getElementById("next-btn").focus()},Ve=({nftTokensBySeries:t,nftTokensForOwner:e,nftCollections:i})=>{Ie({nftTokensBySeries:t,nftTokensForOwner:e,nftCollections:i})},Qe=()=>{if(Be)return;const t=document.getElementById("coil-subscriber"),e=document.getElementById("coil-btn");e&&e.remove(),t&&t.classList.remove("hide");const i=document.getElementsByClassName("bonus-item");for(let t of i)t.classList.remove("disabled");i&&i.length&&(Be=!0)},Je=()=>{document.getElementById("loading-wrapper").classList.remove("hide")};class He{player;constructor(t){this.player=t,this.initControls()}updateControls(){(yt("arrowleft")||yt("a")||K("dpadleft"))&&(this.player.applyForce(-1.5,-1),this.player.changePlayerDirection(!0)),(yt("arrowright")||yt("d")||K("dpadright"))&&(this.player.applyForce(1.5,-1),this.player.changePlayerDirection(!1)),(yt("space")||K("south"))&&this.player.applyForce(0,-5)}cutRope=()=>{this.player.rope.cutRope(Math.floor(this.player.rope.length/2))};initControls(){ft(["s"],this.cutRope),J("west",this.cutRope),ft(["z"],this.restartLevel)}restartLevel=()=>{r("r")};destroy=()=>{wt(["s"],this.cutRope),H("west",this.cutRope),wt(["z"],this.restartLevel)}}class Ke{n1;n2;restingDistance=7;constructor(t,e){this.n1=t,this.n2=e}}class qe{pos;oldPos;width=2;height=2;mass=.03;constructor({x:t,y:e}){this.pos=x(t,e),this.oldPos=x(t,e)}get x(){return this.pos.x}get y(){return this.pos.y}applyForce(t,e){this.pos.x+=t,this.pos.y+=e}}class Ze{nodes=[];links=[];anchor;iterations=20;constructor({x:t,y:e,numNodes:i,level:s}){this.level=s,this.anchor=x(t,e);for(let s=0;s<i;s++)this.nodes.push(new qe({x:t,y:7*s+e}));for(let t=0;t<this.nodes.length-1;t++){const e=this.nodes[t],i=this.nodes[t+1];this.links.push(new Ke(e,i))}}update(){this.updateNodes();for(let t=0;t<this.iterations;t++)this.updateLinks(),this.constrainNodes()}render(t){t&&this.renderRope(t)}updateNodes(){this.nodes.forEach((t=>{t===this.nodes[0]&&(t.pos=this.anchor);const e=t.pos.subtract(t.oldPos);t.oldPos=t.pos,t.pos=t.pos.add(e).add(x(0,9*t.mass))}))}constrainNodes(){this.nodes.forEach((t=>{t===this.nodes[0]&&(t.pos=this.anchor),this.handleWallCollision(t),this.handleBoxCollision(t)}))}updateLinks(){this.links.forEach((t=>{const e=t.n2.pos.subtract(t.n1.pos),i=e.length(),s=(t.restingDistance-i)/i/2,n=x(e.x*s,e.y*s);t.n1.pos=t.n1.pos.subtract(n),t.n2.pos=t.n2.pos.add(n)}))}renderRope(t){t.lineWidth=4,t.strokeStyle="#e9efec",t.beginPath(),this.links.forEach((e=>{t.moveTo(e.n1.x,e.n1.y),t.lineTo(e.n2.x,e.n2.y)})),t.stroke()}handleWallCollision(t){t.x>St&&(t.pos.x=St),t.x<0&&(t.pos.x=0),t.y>Bt&&(t.pos.y=Bt),t.y<0&&(t.pos.y=0)}handleBoxCollision(t,e){if(t===this.nodes[0])return;this.level.bricks.forEach((e=>{if(zt(e,t)){const i=Math.abs(t.pos.x-e.x),s=Math.abs(t.pos.x-(e.x+e.width)),n=Math.abs(t.pos.y-e.y),a=Math.abs(t.pos.y-(e.y+e.height)),o=Math.max(i,s,n,a);o===s?t.pos.x=e.x-3:o===i?t.pos.x=e.x+e.width+3:o===a?t.pos.y=e.y-3:o===n&&(t.pos.y=e.y+e.height+3)}}))}cutRope(t){t>=this.nodes.length-1&&(t=this.nodes.length-2),this.links.splice(t,1),console.log("play cut rope"),jt(window.sfxContext,...[,,1081,.01,.01,.02,4,1.1,14,32,,,,.8,,,.06,.66]),r("c",{rope:this})}get length(){return this.nodes.length}get endNode(){return this.nodes[this.nodes.length-1]}get anchorNode(){return this.nodes.length?this.nodes[0]:{}}}class $e{timeBetweenBubbles=10;timeSinceLastBubble=10;timeSinceLastBoostBubble=10;constructor(){this.pool=At({create:w,maxSize:20})}render(){this.pool.render()}update(){this.timeSinceLastBubble+=1,this.timeSinceLastBoostBubble+=5,this.pool.update()}addBubbles({x:t,y:e,isBoost:i}){!i&&this.timeSinceLastBubble<=this.timeBetweenBubbles||i&&this.timeSinceLastBoostBubble<=this.timeBetweenBubbles||(jt(window.sfxContext,...[,1,7,.02,.01,.02,4,.5,,,1,.01,,,150,,.21,,.01]),this.timeSinceLastBubble=0,this.timeSinceLastBoostBubble=0,this.pool.get({x:t/2,y:e/2,width:20,height:40,color:"#e9efec",ttl:50,render:function(){let t=8;i&&(t=4);const e=this.context;e.lineWidth=2,e.globalAlpha=this.ttl/60,e.strokeStyle=this.color,e.beginPath(),e.arc(this.x,this.y,t,0,2*Math.PI),e.stroke()},update:function(t){this.ttl-=1,this.x+=Math.random()>.5?1:-1,this.y-=1,i&&this.ttl>30?this.y+=2:i&&(this.y+=1.5)}}))}}const ti=[],ei=[];let ii;const si=t=>{if(!t||!t.length)return;let e=document.getElementById("game-canvas").getBoundingClientRect();const i=parseFloat(St/e.width),s=parseFloat(Bt/e.height),n=[];for(let a=0;a<t.length;a++)n.push({id:t[a].identifier,x:(t[a].pageX-e.left)*i,y:(t[a].pageY-e.top)*s,draws:6});return n},ni=t=>{const e=t.changedTouches;if(!e.length)return;const i=si(e);ti.splice(ti.length,0,...i)},ai=t=>{for(let e=0;e<ei.length;e++){if(ei[e].identifier===t)return e}return-1},oi=t=>{jt(window.sfxContext,0),ii=!0;const e=si(t.changedTouches);ei.push(...e),console.log("handle start",t)},hi=t=>{const e=t.changedTouches;for(let t=0;t<e.length;t++){let i=ai(e[t].identifier);ei.splice(i,1)}},ri=t=>{ii=!1,hi(t),console.log("handle end ",t)},li=t=>{ii=!1,hi(t),console.log("handle cancel",t)},di=t=>{(t=>{ei.forEach((e=>{e.y>Bt-Bt/5&&t.applyForce(0,-5),e.x>St-St/5&&(t.applyForce(1.5,-1),t.changePlayerDirection(!1)),e.x<=St/5&&(t.applyForce(-1.5,-1),t.changePlayerDirection(!0))}))})(t)},ci=()=>{const t=document.getElementById("game-canvas");t.addEventListener("touchmove",ni),t.addEventListener("touchstart",oi),t.addEventListener("touchend",ri),t.addEventListener("touchcancel",li)},pi=t=>{if(ti.length){ii||ti[0].draws--,t.strokeStyle="#e9efec";for(let e=0;e<ti.length-1;e++){const i=ti[e],s=ti[e+1];i.draws>0&&s.draws>0&&(t.lineWidth=2*i.draws,t.beginPath(),t.moveTo(i.x,i.y),t.lineTo(s.x,s.y),t.stroke()),i.draws--}(()=>{for(let t=ti.length-1;t>=0;t--)ti[t].draws<=0&&ti.splice(t,1)})()}};class ui{game;rope=[];playerControls;scale=4;sprite={render:()=>{},x:0,y:0};headSprite={render:()=>{},x:0,y:0};hasWon=!1;hasSetListeners=!1;headImg;headOffset={x:10,y:38};isLeft=!1;isRopeCut=!1;anchorNodeSpeed=1;anchorNodeDirection;anchorNodeOrgPos;particleEffect;deadTimer=0;deadInAirTimer=0;deadLimit=50;deadInAirLimit=250;playerState="a";constructor({game:e,levelData:i}){i.p=i.p||{},this.levelData=i,this.anchorNodeDirection=kt(i.p.b,i.p.d),this.distance=Math.abs(i.p.d),this.behavior=i.p.b,this.game=e;const s=i.r,n=i.p.x,a=i.p.y;this.anchorNodeOrgPos=x(n,a),this.headImg=Mt.img||{width:0,height:0},this.createRope({startX:n,startY:a,ropeLength:s,levelData:i}),Yt({x:n,y:a,scale:this.scale,imgSrc:t("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAIBAMAAAA2IaO4AAAAAXNSR0IArs4c6QAAABJQTFRF9u3NAAAA6e%2FsoKCLVVVoIR4gJR%2FcEQAAAAJ0Uk5TAAB2k804AAAAK0lEQVR42mMQDA1lZBBVUgpkCFJSUmUIClUNZQgKVjWFcEWdVAIYBENDBQGBlgaUUfu3rwAAAABJRU5ErkJggg%3D%3D")}).then((t=>this.sprite=t)),this.createHeadSprite(this.headImg),this.playerControls=new He(this),this.listenForGameEvents(),this.particleEffect=new $e}updateRope(){this.hasWon||this.rope.update()}renderRope(t){this.hasWon||this.rope.render(t)}createHeadSprite(t){if(!t.width||!t.height)return;const e=this.scale/2;let i=e;this.isLeft&&(i*=-1),this.headSprite=w({x:this.rope.endNode.x-t.width,y:this.rope.endNode.y-t.height,anchor:{x:.5,y:.5},width:8,height:8,image:t,scaleX:i,scaleY:e})}createRope({startX:t,startY:e,ropeLength:i}){this.rope=new Ze({x:t,y:e,numNodes:i,level:this.game.level}),this.isRopeCut=!1}renderPlayer(t){this.sprite.render(),this.headSprite.render()}applyForce(t,e){const i=e<-4;this.particleEffect.addBubbles({x:this.sprite.x,y:this.sprite.y,isBoost:i}),this.rope.endNode.applyForce(t,e)}changePlayerDirection(t){this.isLeft=t,t?(this.sprite.scaleX=-this.scale,this.headSprite.scaleX=-this.scale/2):(this.sprite.scaleX=this.scale,this.headSprite.scaleX=this.scale/2),this.headSprite.x=this.sprite.x-(this.headImg.width-this.headOffset.x)*Math.sign(this.sprite.scaleX)}render(t){this.renderRope(t),this.renderPlayer(t),this.particleEffect.render(t)}renderCollisionBox(t){t.lineWidth=4,t.strokeStyle="#e9efec",t.beginPath(),t.rect(this.sprite.x,this.sprite.y,this.sprite.width*this.scale,this.sprite.height*this.scale),t.stroke()}update(){this.sprite.x=this.rope.endNode.pos.x,this.sprite.y=this.rope.endNode.pos.y,this.headSprite.x=this.rope.endNode.pos.x-(this.headImg.width-this.headOffset.x)*Math.sign(this.sprite.scaleX),this.headSprite.y=this.rope.endNode.pos.y-this.headImg.height+ +this.headOffset.y,this.particleEffect.update(),this.updateRope(),this.updateAnchorNode(),this.handlePlayerState(),this.hasWon||this.isRopeCut||this.rope.length<=0||(di(this),this.playerControls.updateControls())}handlePlayerState(){this.handleDeadOnGround(),this.handleDeadInAir()}handleDeadOnGround(){"d"!==this.playerState&&this.sprite.y>=Bt&&(this.deadTimer+=1,this.deadTimer>=this.deadLimit&&this.handleDied())}handleDeadInAir(){this.hasWon||this.isRopeCut&&"d"!==this.playerState&&(this.deadInAirTimer+=1,this.deadInAirTimer>=this.deadInAirLimit&&this.handleDied())}handleDied(){this.deadTimer=0,this.deadInAirTimer=0,this.playerState="d",r("d",{})}updateAnchorNode(){const t=this.rope.anchorNode,{axis:e,newDirection:i,smoothSpeed:s}=_t({behavior:this.behavior,distance:this.distance,direction:this.anchorNodeDirection,x:t.pos.x,y:t.pos.y,orgX:this.anchorNodeOrgPos.x,orgY:this.anchorNodeOrgPos.y});this.anchorNodeDirection=i,t.pos[e]+=this.anchorNodeSpeed*s[e]}reArrangeRope(){this.rope.splice(this.rope.length-2,1);const t=this.rope[this.rope.length-2];t&&(t.removeLink(),t.attachTo(this.pointMass))}respawnPlayer(){const t=this.levelData.r,e=this.levelData.p.x,i=this.levelData.p.y;this.anchorNodeDirection=kt(this.levelData.p.b,this.levelData.p.d),this.createRope({startX:e,startY:i,ropeLength:t,levelData:this.levelData}),this.playerState="a"}listenForGameEvents(){this.hasSetListeners||(o("g",this.onGoalCollision),o("i",this.onArcadianAdded),o("c",this.onCutRope),this.hasSetListeners=!0)}onGoalCollision=()=>{this.hasWon=!0};onArcadianAdded=({img:t})=>{this.headImg=t,this.createHeadSprite(t)};onCutRope=({rope:t})=>{this.isRopeCut=!0};destroy=()=>{this.playerControls&&this.playerControls.destroy(),h("g",this.onGoalCollision),h("i",this.onArcadianAdded),h("c",this.onCutRope)};get currPos(){return this.rope.endNode.pos}get oldPos(){return this.rope.endNode.oldPos}set currPos(t){this.rope.endNode.currPos=t}set oldPos(t){this.rope.endNode.oldPos=t}}class gi{x;y;orgX;orgY;sprite={render:()=>{}};distance=100;speed=1;scale=4;rotSpeed=.2;width=8;height=8;level;constructor(e,i,{behavior:s,distance:n,level:a}){this.direction=kt(s,n),this.distance=Math.abs(n),this.behavior=s,this.x=e,this.y=i,this.orgX=e,this.orgY=i,this.level=a,Yt({x:this.x,y:this.y,width:this.width,height:this.height,scale:this.scale,imgSrc:t("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAIBAMAAAA2IaO4AAAAAXNSR0IArs4c6QAAAA9QTFRFAAAA6e%2FsoKCLVVVoIR4gQ1uK0QAAAAF0Uk5TAEDm2GYAAAArSURBVHjaBcCBCQAQEADAIwMoCygT8AZQv%2F9OosB6iJjazW3cfGoE2oHuAz4SAw96QFa2AAAAAElFTkSuQmCC")}).then((t=>this.sprite=t))}update(){const{axis:t,newDirection:e,smoothSpeed:i}=_t({behavior:this.behavior,distance:this.distance,direction:this.direction,x:this.x,y:this.y,orgX:this.orgX,orgY:this.orgY});this.direction=e,this[t]+=this.speed*i[t],this.sprite.x=this.x,this.sprite.y=this.y,this.sprite.rotation+=this.rotSpeed}render(t){this.sprite.render()}}class yi{player;saws=[];goals=[];bricks=[];isLevelLoaded=!1;isFirstRopeCut=!1;isStopMotion=!1;levelId;levelData;stopMotionTime=10;stopMotionEllapsed=0;constructor({game:t,levelId:e,levelData:i}){this.levelId=e,this.levelData=i,this.game=t,i?setTimeout((()=>{this.init(i)})):this.loadLevel("level"+e).then((t=>{this.init(t)})).catch((()=>{Xe("thanks")})),this.listenForGameEvents()}init(t){this.levelData=t,this.createPlayer(t),this.createSaws(t),this.createGoals(t),this.createBricks(t),this.isLevelLoaded=!0,Lt(this.levelId)}loadLevel(t){return new Promise(((e,i)=>{if(ee[t]&&ee[t].p){e(ee[t])}else i(null)}))}render(t){this.isLevelLoaded&&(this.saws.forEach((e=>{e.render(t)})),this.bricks.forEach((e=>{e.render(t)})),this.player.render(t),this.goals.forEach((e=>{e.render(t)})))}update(t){if(this.isLevelLoaded){if(this.isStopMotion)return this.stopMotionEllapsed+=1,void(this.stopMotionEllapsed>=this.stopMotionTime&&(this.isStopMotion=!1));this.checkCollisions(),this.player.update(t),this.saws.forEach((e=>{e.update(t)})),this.goals.forEach((e=>{e.update(t)})),this.bricks.forEach((e=>{e.update(t)}))}}createGoals(t){t.g.forEach((t=>{this.goals.push(new te(t.x,t.y,{level:this}))}))}createPlayer(t){this.player=new ui({levelData:t,game:this.game})}createSaws(t){t.s&&t.s.forEach((t=>{this.saws.push(new gi(t.x,t.y,{level:this,behavior:t.b,distance:t.d}))}))}createBricks(t){t.b&&t.b.forEach((t=>{this.bricks.push(new Et(t.x,t.y,{behavior:t.b,distance:t.d,level:this}))}))}listenForGameEvents(){o("d",this.onPlayerDied),o("l",this.onLevelComplete),o("c",this.onCutRope)}onCutRope=({rope:t})=>{this.isFirstRopeCut||(this.isStopMotion=!0,this.isFirstRopeCut=!0,this.flashScreen())};onLevelComplete=()=>{};flashScreen(){const t=document.getElementById("game-canvas");t.classList.add("flash"),setTimeout((()=>{requestAnimationFrame((()=>{t.classList.remove("flash")}))}),50)}onPlayerDied=({})=>{jt(window.sfxContext,...[,,326,,.06,.08,1,.95,-6.8,,,,,,,,,.45,.08]),this.isFirstRopeCut=!1,this.stopMotionEllapsed=0,this.player.respawnPlayer(),this.resertSaws(),this.resetBricks()};resetBricks(){this.bricks.length=0,this.createBricks(this.levelData)}resertSaws(){this.saws.length=0,this.createSaws(this.levelData)}checkTouchCollision(){if(!ti.length)return;const t=this.player.rope;for(let e=0;e<ti.length-1;e++)for(let i=0;i<t.length-1;i++)Tt(ti[e],ti[e+1],t.nodes[i],t.nodes[i+1])&&this.player.rope.cutRope(i)}checkCollisions(){const t=this.player.rope;for(let e=0;e<t.length-2;e++)this.saws.forEach((i=>{zt(t.nodes[e],{width:i.width*i.scale,height:i.height*i.scale,...i})&&this.player.rope.cutRope(e)}));this.checkTouchCollision()}destroy(){h("d",this.onPlayerDied),h("l",this.onLevelComplete),h("c",this.onCutRope),this.player&&this.player.destroy()}}class mi{canvas;context;player;saw;level;isAdPlaying;deathCount;setDeathCount;updateLevelsCompleted;constructor({setDeathCount:t,updateLevelsCompleted:e}){this.initDeathCount(),this.updateLevelsCompleted=e||(()=>{}),this.setDeathCount=t||(()=>{});const i=this;let{canvas:s,context:n}=p();var a,o;n.textBaseline="middle",n.lineJoin="round",n.lineCap="round",n.imageSmoothingEnabled=!1,this.canvas=s,this.context=n,vt(),Ht(),ci(),Ft(),Rt||(Rt=!0,window.addEventListener("resize",Ft)),a=s.height,Bt=a,o=s.width,St=o,T({update:function(t){i.isAdPlaying||i.level&&i.level.update(t)},render:function(){i.isAdPlaying||i.level&&(n.save(),i.level.render(n),pi(n))}}).start(),this.listenForGameEvents()}initDeathCount=()=>{const t=Number(ne("deathCount"));Number.isNaN(t)?this.deathCount=0:this.deathCount=t};loadLevel({levelId:t,levelData:e}){this.level&&this.level.destroy(),t?this.level=new yi({levelId:t,game:this}):e&&(this.level=new yi({game:this,levelData:e}))}listenForGameEvents(){o("x",this.onStartNextLevel),o("s",this.onStartLevel),o("r",this.onReStartLevel),o("t",this.onToggleMusic),o("levelQuit",this.onLevelQuit),o("adFinished",this.onAdFinished),o("adPlaying",this.onAdPlaying),o("d",this.onPlayerDead),o("l",this.onLevelComplete)}onLevelComplete=()=>{const t=`level${this.level.levelId}`;se(t,!0),this.updateLevelsCompleted({[t]:!0})};onPlayerDead=()=>{this.deathCount++,se("deathCount",this.deathCount),this.setDeathCount(this.deathCount)};onAdPlaying=()=>{this.isAdPlaying=!0};onAdFinished=()=>{this.isAdPlaying=!1};onToggleMusic=()=>{Jt?(Vt=!1,Zt()):(Vt=!0,$t())};onStartNextLevel=()=>{this.level.destroy(),this.level.levelId?this.loadLevel({levelId:this.level.levelId+1}):Xe("near-levels")};onStartLevel=({levelId:t,levelData:e})=>{this.loadLevel({levelId:t,levelData:e})};onReStartLevel=()=>{this.loadLevel({levelId:this.level.levelId,levelData:this.level.levelData})};onLevelQuit=()=>{this.level&&this.level.destroy()}}const xi=t=>{It=!0,r("p",t)},vi=(t,e,i)=>{if(!De)return;const s=document.activeElement.nextElementSibling;s&&s.focus()},fi=(t,e)=>{vi()},wi=(t,e)=>{vi()},bi=({setDeathCount:t,updateLevelsCompleted:e})=>{document.getElementById("hang-by-a-thread").innerHTML='\n  <div id="wrap">\n      <div id="loading-wrapper" class="overlay hide">\n        <div id="loading"></div>\n      </div>\n      <canvas id="game-canvas" width="800px" height="800px"> </canvas>\n      <div id="r-menu" class="menu">\n        <div id="hamburger">––</div>\n      </div>\n      <menu id="main" class="overlay">\n        <button id="select-level-btn">Select Level</button>\n        \x3c!-- <button id="near-login-loading-btn">Loading..</button>\n        <button id="near-level-btn" class="disabled" disabled>\n          NEAR Levels\n        </button> --\x3e\n        \x3c!-- <button id="bonus-content-btn">Bonus Content</button> --\x3e\n        <button id="music-btn" class="flat">Music is OFF</button>\n      </menu>\n      <div id="bonus" class="overlay hide">\n        <div id="coil-subscriber" class="hide">\n          Thanks for subscribing to Coil\n        </div>\n\n        <span id="coil-btn">Access more hats for Coil subscribers</span>\n        <div id="bonus-grid"></div>\n      </div>\n      <div id="levels" class="overlay hide">\n        <div id="levels-grid"></div>\n      </div>\n      <div id="near-levels" class="overlay hide">\n        <div id="loading-near-levels">Loading NEAR levels..</div>\n        <div id="near-levels-grid"></div>\n      </div>\n      <menu id="level-dialog" class="overlay hide">\n        <button id="next-btn">Play next level</button>\n        <button id="replay-btn">Replay level</button>\n      </menu>\n      <div id="thanks" class="overlay hide">\n        Rest in peace my soul\n        <br />\n        Thank you for playing\n      </div>\n      <div id="hint"></div>\n    </div>',_i(),new mi({setDeathCount:t,updateLevelsCompleted:e}),Ci(e),Ai(t),Fe(),Ge(),Ye(),Ne(),Me(),ft(["w","arrowup"],fi),J("dpadup",fi),ft(["s","arrowdown"],wi),J("dpaddown",wi),me(),document&&document.monetization?document.monetization.addEventListener("monetizationprogress",(t=>xi(t))):window.addEventListener("monetizationprogress",(t=>xi(t)))},Ai=(t=(()=>{}))=>{const e=Number(ne("deathCount"));Number.isNaN(e)||t(e)},Ci=(t=(()=>{}))=>{const e={};for(let t=1;t<ie+1;t++){const i=`level${t}`,s=Boolean(ne(i));s&&(e[i]=s)}t(e)},_i=()=>{let e=document.createElement("style");e.textContent=t(':root{--bgc:#211e20;--bgc2:#555568;--fgc:#a0a08b;--fgc2:#e9efec;--acc:#e20fa0}#hang-by-a-thread{-webkit-user-select:none;user-select:none;color:var(--fgc2);flex-flow:column;display:flex}#hang-by-a-thread #wrap{height:100%;width:100vw;max-height:100vh;flex-flow:column;place-content:center;align-self:center;font-family:sans-serif;display:flex;position:relative}#hang-by-a-thread #wrap.autoWidth{width:100vw;max-width:100vh}#hang-by-a-thread #wrap.autoHeight{height:auto;max-height:100vw}#hang-by-a-thread canvas{background-color:var(--bgc)}#hang-by-a-thread .menu{color:var(--fgc2);flex-direction:row-reverse;align-content:center;align-items:center;padding:10px 20px;font-size:23px;font-weight:600;display:flex;position:absolute}#hang-by-a-thread #r-menu{top:0;right:0}#hang-by-a-thread #music-btn{margin-top:50px}#hang-by-a-thread .flat{background-color:inherit;color:var(--fgc2);border:3px solid var(--fgc2)}#hang-by-a-thread #hamburger{height:9px;cursor:pointer;flex-direction:column;align-items:center;line-height:.4;display:flex}#hang-by-a-thread #hint{white-space:pre-wrap;text-align:center;align-self:center;font-size:2vmin;display:flex;position:absolute;bottom:5%}#hang-by-a-thread #hamburger,#hang-by-a-thread #hamburger:after,#hang-by-a-thread #hamburger:before{content:"––"}#hang-by-a-thread #hamburger:hover{filter:drop-shadow(0 0 12px var(--acc))}#hang-by-a-thread button,#hang-by-a-thread .btn{width:240px;height:50px;background-color:var(--fgc2);color:var(--bgc);cursor:pointer;border:none;border-radius:4px;margin-top:20px;font-size:16px;font-weight:600}#hang-by-a-thread button.disabled{color:#a9a9a9;cursor:not-allowed;background-color:#d3d3d3}#hang-by-a-thread button.disabled img{filter:contrast(.5)}#hang-by-a-thread button:hover,#hang-by-a-thread .btn:hover{background-color:var(--bgc2);color:var(--fgc2)}#hang-by-a-thread button:hover img{filter:none}#hang-by-a-thread #coil-subscriber{height:50px}#hang-by-a-thread #coil-btn{width:400px;height:50px;justify-content:center;align-items:center;text-decoration:none;display:flex}#hang-by-a-thread .overlay{width:100%;height:100%;background-color:var(--bgc);text-align:center;flex-direction:column;place-content:center;align-items:center;margin:0;padding:0;display:flex;position:absolute;top:0}#hang-by-a-thread #thanks{width:80%;height:80%}#hang-by-a-thread .level-item{cursor:pointer;aspect-ratio:1/1;width:60%;height:auto;max-height:70%;background-color:var(--fgc);border-radius:4px;flex-flow:column;justify-content:center;align-self:center;align-items:center;display:flex}#hang-by-a-thread .level-item img{width:100%;height:auto}#hang-by-a-thread .level-item img:not(.collected){filter:grayscale()}#hang-by-a-thread #levels-grid,#hang-by-a-thread #bonus-grid,#hang-by-a-thread #near-levels-grid{width:100%;height:100%;scroll-behavior:smooth;grid-template-columns:repeat(3,minmax(auto,150px));grid-auto-rows:minmax(120px,min-content);place-content:center;place-items:stretch center;display:grid;overflow-x:hidden;overflow-y:auto}#hang-by-a-thread #bonus-grid{align-content:stretch;row-gap:60px}#hang-by-a-thread #near-levels-grid{grid-template-columns:repeat(2,1fr)}#hang-by-a-thread #near-levels-grid .level-item{width:250px;height:300px;cursor:pointer;flex-flow:column}#hang-by-a-thread #bonus-grid{row-gap:0}#hang-by-a-thread #level-dialog{width:100%;height:100%;background-color:#121212ee;border:1px solid #fff;border-radius:4px;align-self:center;display:flex}#hang-by-a-thread .bonus-item{cursor:pointer;background:0 0;border-radius:4px;margin-bottom:-60px}#hang-by-a-thread .bonus-item:hover:not(.disabled){transform:scale(1.1)}#hang-by-a-thread .bonus-item.disabled{filter:contrast(.5);cursor:not-allowed;background-color:#000}#hang-by-a-thread #bonus-grid>canvas{width:200px;height:200px;max-width:100%;max-height:100%;object-fit:contain}#hang-by-a-thread #loading-wrapper{z-index:99;background-color:#211e2055}#hang-by-a-thread #loading{border:16px solid var(--fgc2);border-top:16px solid var(--acc);width:120px;height:120px;border-radius:50%;animation:spin 2s linear infinite}@keyframes spin{0%{transform:rotate(0deg)}to{transform:rotate(360deg)}}#hang-by-a-thread .inverse{position:absolute;top:-1px;left:-2px;transform:rotate(90deg)}#hang-by-a-thread .hide{display:none!important}#hang-by-a-thread .flash{background-color:var(--bgc2)}');document.getElementsByTagName("head")[0].appendChild(e)};export{bi as initGame};
//# sourceMappingURL=game.js.map
