function t(t){return t&&t.__esModule?t.default:t}let e=()=>{};function i(t,e){let i=t.indexOf(e);if(-1!=i)return t.splice(i,1),!0}let s,n,o={};function a(t,e){o[t]=o[t]||[],o[t].push(e)}function h(t,e){o[t]=(o[t]||[]).filter((t=>t!=e))}function r(t,...e){(o[t]||[]).map((t=>t(...e)))}let l={get:(t,i)=>"_proxy"==i||e};function d(){return s}function c(){return n}function p(t,{contextless:e=!1}={}){if(s=document.getElementById(t)||t||document.querySelector("canvas"),e&&(s=s||new Proxy({},l)),!s)throw Error("You must provide a canvas element for the game");return n=s.getContext("2d")||new Proxy({},l),n.imageSmoothingEnabled=!1,r("init"),{canvas:s,context:n}}function u(t,e){let i=Math.sin(e),s=Math.cos(e);return{x:t.x*s-t.y*i,y:t.x*i+t.y*s}}function g(t,e,i){return Math.min(Math.max(t,i),e)}function y(t){let{x:e=0,y:i=0,width:s,height:n}=t.world||t;return t.mapwidth&&(s=t.mapwidth,n=t.mapheight),t.anchor&&(e-=s*t.anchor.x,i-=n*t.anchor.y),s<0&&(e+=s,s*=-1),n<0&&(i+=n,n*=-1),{x:e,y:i,width:s,height:n}}class m{constructor(t=0,e=0,i={}){this.x=t,this.y=e,i._c&&(this.clamp(i._a,i._b,i._d,i._e),this.x=t,this.y=e)}add(t){return new m(this.x+t.x,this.y+t.y,this)}subtract(t){return new m(this.x-t.x,this.y-t.y,this)}scale(t){return new m(this.x*t,this.y*t)}normalize(t=this.length()){return new m(this.x/t,this.y/t)}dot(t){return this.x*t.x+this.y*t.y}length(){return Math.hypot(this.x,this.y)}distance(t){return Math.hypot(this.x-t.x,this.y-t.y)}angle(t){return Math.acos(this.dot(t)/(this.length()*t.length()))}clamp(t,e,i,s){this._c=!0,this._a=t,this._b=e,this._d=i,this._e=s}get x(){return this._x}get y(){return this._y}set x(t){this._x=this._c?g(this._a,this._d,t):t}set y(t){this._y=this._c?g(this._b,this._e,t):t}}function x(){return new m(...arguments)}class f extends class{constructor(t){return this.init(t)}init(t={}){this.position=x(),this.velocity=x(),this.acceleration=x(),this.ttl=1/0,Object.assign(this,t)}update(t){this.advance(t)}advance(t){let e=this.acceleration;t&&(e=e.scale(t)),this.velocity=this.velocity.add(e);let i=this.velocity;t&&(i=i.scale(t)),this.position=this.position.add(i),this._pc(),this.ttl--}get dx(){return this.velocity.x}get dy(){return this.velocity.y}set dx(t){this.velocity.x=t}set dy(t){this.velocity.y=t}get ddx(){return this.acceleration.x}get ddy(){return this.acceleration.y}set ddx(t){this.acceleration.x=t}set ddy(t){this.acceleration.y=t}isAlive(){return this.ttl>0}_pc(){}}{init({width:t=0,height:e=0,context:i=c(),render:s=this.draw,update:n=this.advance,children:o=[],anchor:a={x:0,y:0},opacity:h=1,rotation:r=0,scaleX:l=1,scaleY:d=1,...p}={}){this._c=[],super.init({width:t,height:e,context:i,anchor:a,opacity:h,rotation:r,scaleX:l,scaleY:d,...p}),this._di=!0,this._uw(),this.addChild(o),this._rf=s,this._uf=n}update(t){this._uf(t),this.children.map((e=>e.update&&e.update(t)))}render(){let t=this.context;t.save(),(this.x||this.y)&&t.translate(this.x,this.y),this.rotation&&t.rotate(this.rotation),1==this.scaleX&&1==this.scaleY||t.scale(this.scaleX,this.scaleY);let e=-this.width*this.anchor.x,i=-this.height*this.anchor.y;(e||i)&&t.translate(e,i),this.context.globalAlpha=this.opacity,this._rf(),(e||i)&&t.translate(-e,-i),this.children.map((t=>t.render&&t.render())),t.restore()}draw(){}_pc(){this._uw(),this.children.map((t=>t._pc()))}get x(){return this.position.x}get y(){return this.position.y}set x(t){this.position.x=t,this._pc()}set y(t){this.position.y=t,this._pc()}get width(){return this._w}set width(t){this._w=t,this._pc()}get height(){return this._h}set height(t){this._h=t,this._pc()}_uw(){if(!this._di)return;let{_wx:t=0,_wy:e=0,_wo:i=1,_wr:s=0,_wsx:n=1,_wsy:o=1}=this.parent||{};this._wx=this.x,this._wy=this.y,this._ww=this.width,this._wh=this.height,this._wo=i*this.opacity,this._wsx=n*this.scaleX,this._wsy=o*this.scaleY,this._wx=this._wx*n,this._wy=this._wy*o,this._ww=this.width*this._wsx,this._wh=this.height*this._wsy,this._wr=s+this.rotation;let{x:a,y:h}=u({x:this._wx,y:this._wy},s);this._wx=a,this._wy=h,this._wx+=t,this._wy+=e}get world(){return{x:this._wx,y:this._wy,width:this._ww,height:this._wh,opacity:this._wo,rotation:this._wr,scaleX:this._wsx,scaleY:this._wsy}}set children(t){this.removeChild(this._c),this.addChild(t)}get children(){return this._c}addChild(...t){t.flat().map((t=>{this.children.push(t),t.parent=this,t._pc=t._pc||e,t._pc()}))}removeChild(...t){t.flat().map((t=>{i(this.children,t)&&(t.parent=null,t._pc())}))}get opacity(){return this._opa}set opacity(t){this._opa=t,this._pc()}get rotation(){return this._rot}set rotation(t){this._rot=t,this._pc()}setScale(t,e=t){this.scaleX=t,this.scaleY=e}get scaleX(){return this._scx}set scaleX(t){this._scx=t,this._pc()}get scaleY(){return this._scy}set scaleY(t){this._scy=t,this._pc()}}class w extends f{init({image:t,width:e=(t?t.width:void 0),height:i=(t?t.height:void 0),...s}={}){super.init({image:t,width:e,height:i,...s})}get animations(){return this._a}set animations(t){let e,i;for(e in this._a={},t)this._a[e]=t[e].clone(),i=i||this._a[e];this.currentAnimation=i,this.width=this.width||i.width,this.height=this.height||i.height}playAnimation(t){this.currentAnimation=this.animations[t],this.currentAnimation.loop||this.currentAnimation.reset()}advance(t){super.advance(t),this.currentAnimation&&this.currentAnimation.update(t)}draw(){this.image&&this.context.drawImage(this.image,0,0,this.image.width,this.image.height),this.currentAnimation&&this.currentAnimation.render({x:0,y:0,width:this.width,height:this.height,context:this.context}),this.color&&(this.context.fillStyle=this.color,this.context.fillRect(0,0,this.width,this.height))}}function v(){return new w(...arguments)}let b=new WeakMap,A={},_={},k={0:"left",1:"middle",2:"right"};function C(t,e){let{x:i,y:s,width:n,height:o}=y(t);do{i-=t.sx||0,s-=t.sy||0}while(t=t.parent);let a=e.x-Math.max(i,Math.min(e.x,i+n)),h=e.y-Math.max(s,Math.min(e.y,s+o));return a*a+h*h<e.radius*e.radius}function E(t){let e=t._lf.length?t._lf:t._cf;for(let i=e.length-1;i>=0;i--){let s=e[i];if(s.collidesWithPointer?s.collidesWithPointer(t):C(s,t))return s}}function S(t,e){return parseFloat(t.getPropertyValue(e))||0}function L(t){let e=null!=t.button?k[t.button]:"left";_[e]=!0,N(t,"onDown")}function B(t){let e=null!=t.button?k[t.button]:"left";_[e]=!1,N(t,"onUp")}function D(t){N(t,"onOver")}function M(t){b.get(t.target)._oo=null,_={}}function I(t,e,i){let s=E(t);s&&s[e]&&s[e](i),A[e]&&A[e](i,s),"onOver"==e&&(s!=t._oo&&t._oo&&t._oo.onOut&&t._oo.onOut(i),t._oo=s)}function N(t,e){t.preventDefault();let i=t.target,s=b.get(i),{scaleX:n,scaleY:o,offsetX:a,offsetY:h}=function(t){let{canvas:e,_s:i}=t,s=e.getBoundingClientRect(),n="none"!=i.transform?i.transform.replace("matrix(","").split(","):[1,1,1,1],o=parseFloat(n[0]),a=parseFloat(n[3]),h=(S(i,"border-left-width")+S(i,"border-right-width"))*o,r=(S(i,"border-top-width")+S(i,"border-bottom-width"))*a,l=(S(i,"padding-left")+S(i,"padding-right"))*o,d=(S(i,"padding-top")+S(i,"padding-bottom"))*a;return{scaleX:(s.width-h-l)/e.width,scaleY:(s.height-r-d)/e.height,offsetX:s.left+(S(i,"border-left-width")+S(i,"padding-left"))*o,offsetY:s.top+(S(i,"border-top-width")+S(i,"padding-top"))*a}}(s);t.type.includes("touch")?(Array.from(t.touches).map((({clientX:t,clientY:e,identifier:i})=>{let r=s.touches[i];r||(r=s.touches[i]={start:{x:(t-a)/n,y:(e-h)/o}},s.touches.length++),r.changed=!1})),Array.from(t.changedTouches).map((({clientX:i,clientY:l,identifier:d})=>{let c=s.touches[d];c.changed=!0,c.x=s.x=(i-a)/n,c.y=s.y=(l-h)/o,I(s,e,t),r("touchChanged",t,s.touches),"onUp"==e&&(delete s.touches[d],s.touches.length--,s.touches.length||r("touchEnd"))}))):(s.x=(t.clientX-a)/n,s.y=(t.clientY-h)/o,I(s,e,t))}function R({radius:t=5,canvas:e=d()}={}){let i=b.get(e);if(!i){let s=window.getComputedStyle(e);i={x:0,y:0,radius:t,touches:{length:0},canvas:e,_cf:[],_lf:[],_o:[],_oo:null,_s:s},b.set(e,i)}return e.addEventListener("mousedown",L),e.addEventListener("touchstart",L),e.addEventListener("mouseup",B),e.addEventListener("touchend",B),e.addEventListener("touchcancel",B),e.addEventListener("blur",M),e.addEventListener("mousemove",D),e.addEventListener("touchmove",D),i._t||(i._t=!0,a("tick",(()=>{i._lf.length=0,i._cf.map((t=>{i._lf.push(t)})),i._cf.length=0}))),i}function P(t,e){let i=t[0].toUpperCase()+t.substr(1);A["on"+i]=e}function z(t){let e=t[0].toUpperCase()+t.substr(1);A["on"+e]=0}function F(t){let e=t.canvas;t.clearRect(0,0,e.width,e.height)}function X({fps:t=60,clearCanvas:i=!0,update:s=e,render:n,context:o=c(),blur:a=!1}={}){if(!n)throw Error("You must provide a render() function");let h,l,d,p,u,g=0,y=1e3/t,m=1/t,x=i?F:e,f=!0;function w(){if(l=requestAnimationFrame(w),f&&(d=performance.now(),p=d-h,h=d,!(p>1e3))){for(r("tick"),g+=p;g>=y;)u.update(m),g-=y;x(o),u.render()}}return a||(window.addEventListener("focus",(()=>{f=!0})),window.addEventListener("blur",(()=>{f=!1}))),u={update:s,render:n,isStopped:!0,start(){h=performance.now(),this.isStopped=!1,requestAnimationFrame(w)},stop(){this.isStopped=!0,cancelAnimationFrame(l)},_frame:w,set _last(t){h=t}},u}let T=[],Y={},O={},j={0:"south",1:"east",2:"west",3:"north",4:"leftshoulder",5:"rightshoulder",6:"lefttrigger",7:"righttrigger",8:"select",9:"start",10:"leftstick",11:"rightstick",12:"dpadup",13:"dpaddown",14:"dpadleft",15:"dpadright"};function G(t){T[t.gamepad.index]={pressedButtons:{},axes:{}}}function U(t){delete T[t.gamepad.index]}function V(){T.map((t=>{t.pressedButtons={},t.axes={}}))}function W(){let t=navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads:[];for(let e=0;e<t.length;e++){let i=t[e];if(!i)continue;i.buttons.map(((t,e)=>{let s=j[e],{pressed:n}=t,{pressedButtons:o}=T[i.index],a=o[s];!a&&n?[Y[i.index],Y].map((e=>{e?.[s]?.(i,t)})):a&&!n&&[O[i.index],O].map((e=>{e?.[s]?.(i,t)})),o[s]=n}));let{axes:s}=T[i.index];s.leftstickx=i.axes[0],s.leftsticky=i.axes[1],s.rightstickx=i.axes[2],s.rightsticky=i.axes[3]}}function Q(){window.addEventListener("gamepadconnected",G),window.addEventListener("gamepaddisconnected",U),window.addEventListener("blur",V),a("tick",W)}function J(t,e,{gamepad:i,handler:s="gamepaddown"}={}){let n="gamepaddown"==s?Y:O;[].concat(t).map((t=>{isNaN(i)?n[t]=e:(n[i]=n[i]||{},n[i][t]=e)}))}function K(t,{gamepad:e,handler:i="gamepaddown"}={}){let s="gamepaddown"==i?Y:O;[].concat(t).map((t=>{isNaN(e)?delete s[t]:(s[e]=s[e]||{},delete s[e][t])}))}function H(t,{gamepad:e}={}){return isNaN(e)?T.some((e=>e.pressedButtons[t])):!!T[e]&&!!T[e].pressedButtons[t]}let q,Z={},$=!1,tt={swipe:{touches:1,threshold:10,touchend({0:t}){let e=t.x-t.start.x,i=t.y-t.start.y,s=Math.abs(e),n=Math.abs(i);if(!(s<this.threshold&&n<this.threshold))return s>n?e<0?"left":"right":i<0?"up":"down"}},pinch:{touches:2,threshold:2,touchstart({0:t,1:e}){this.prevDist=Math.hypot(t.x-e.x,t.y-e.y)},touchmove({0:t,1:e}){let i=Math.hypot(t.x-e.x,t.y-e.y);if(Math.abs(i-this.prevDist)<this.threshold)return;let s=i>this.prevDist?"out":"in";return this.prevDist=i,s}}};function et(){$||($=!0,a("touchChanged",((t,e)=>{Object.keys(tt).map((i=>{let s,n=tt[i];(!q||q==i)&&e.length==n.touches&&[...Array(e.length).keys()].every((t=>e[t]))&&(s=n[t.type]?.(e)??"")&&Z[i+s]&&(q=i,Z[i+s](t,e))}))})),a("touchEnd",(()=>{q=0})))}function it(t,e){[].concat(t).map((t=>{Z[t]=e}))}function st(t){[].concat(t).map((t=>{Z[t]=0}))}let nt={},ot={},at={},ht={Enter:"enter",Escape:"esc",Space:"space",ArrowLeft:"arrowleft",ArrowUp:"arrowup",ArrowRight:"arrowright",ArrowDown:"arrowdown"};function rt(t=e,i){t._pd&&i.preventDefault(),t(i)}function lt(t){let e=ht[t.code],i=nt[e];at[e]=!0,rt(i,t)}function dt(t){let e=ht[t.code],i=ot[e];at[e]=!1,rt(i,t)}function ct(){at={}}function pt(){let t;for(t=0;t<26;t++)ht["Key"+String.fromCharCode(t+65)]=String.fromCharCode(t+97);for(t=0;t<10;t++)ht["Digit"+t]=ht["Numpad"+t]=""+t;window.addEventListener("keydown",lt),window.addEventListener("keyup",dt),window.addEventListener("blur",ct)}function ut(t,e,{handler:i="keydown",preventDefault:s=!0}={}){let n="keydown"==i?nt:ot;e._pd=s,[].concat(t).map((t=>n[t]=e))}function gt(t,{handler:e="keydown"}={}){let i="keydown"==e?nt:ot;[].concat(t).map((t=>delete i[t]))}function yt(t){return!!at[t]}function mt(t,e){return Object.values(e).includes(t)}function xt(t){return Object.keys(tt).some((e=>t.startsWith(e)))}function ft(t={}){pt();let e=R(t.pointer);return et(),Q(),{pointer:e}}function wt(t,e,{gamepad:i,key:s}={}){[].concat(t).map((t=>{if(mt(t,j))J(t,e,i);else if(xt(t))it(t,e);else if(mt(t,ht))ut(t,e,s);else{if(!["down","up"].includes(t))throw new TypeError(`"${t}" is not a valid input name`);P(t,e)}}))}function vt(t,{gamepad:e,key:i}={}){[].concat(t).map((t=>{mt(t,j)?K(t,e):xt(t)?st(t):mt(t,ht)?gt(t,i):["down","up"].includes(t)&&z(t)}))}class bt{constructor({create:t,maxSize:e=1024}={}){let i;if(!t||!(i=t())||!(i.update&&i.init&&i.isAlive&&i.render))throw Error("Must provide create() function which returns an object with init(), update(), render(), and isAlive() functions");this._c=t,this.objects=[t()],this.size=0,this.maxSize=e}get(t={}){if(this.size==this.objects.length){if(this.size==this.maxSize)return;for(let t=0;t<this.size&&this.objects.length<this.maxSize;t++)this.objects.push(this._c())}let e=this.objects[this.size];return this.size++,e.init(t),e}getAliveObjects(){return this.objects.slice(0,this.size)}clear(){this.size=this.objects.length=0,this.objects.push(this._c())}update(t){let e,i=!1;for(let s=this.size;s--;)e=this.objects[s],e.update(t),e.isAlive()||(i=!0,this.size--);i&&this.objects.sort(((t,e)=>e.isAlive()-t.isAlive()))}render(){for(let t=this.size;t--;)this.objects[t].render()}}function At(){return new bt(...arguments)}const _t=(t,e,i)=>{let s=Math.max(0,Math.min(1,(i-t)/(e-t)));return s*s*s*(s*(6*s-15)+10)},kt=({behavior:t,direction:e,distance:i,orgX:s,orgY:n,x:o,y:a,dt:h})=>{let r="",l=1,d=e;const c=s-i,p=s+i,u=n-i,g=n+i;switch(t){case"ns":r="y";break;case"ew":r="x"}let y={x:_t(c,p,o),y:_t(u,g,a)};switch(e){case"n":l=-1,y.y<.05&&(d="s");break;case"s":l=1,y.y>.95&&(d="n");break;case"e":l=1,y.x>.95&&(d="w");break;case"w":l=-1,y.x<.05&&(d="e")}return o>s&&(y.x=Math.abs(1-y.x)),a>n&&(y.y=Math.abs(1-y.y)),y.x=y.x*l*5,y.y=y.y*l*5,{axis:r,newDirection:d,smoothSpeed:y}},Ct=(t,e)=>{let i="";return i=e<0?"ew"===t?"w":"n":"ew"===t?"e":"s",i};class Et{x;y;level;width=32;height=32;speed=1;phase=1-2*Math.random();waveDir=1;constructor(t,e,{level:i,behavior:s,distance:n}){this.direction=Ct(s,n),this.distance=Math.abs(n),this.behavior=s,this.orgX=t,this.orgY=e,this.x=t,this.y=e,this.level=i}getSmallCollisionBox(){return{x:this.x+10,y:this.y+10,width:12,height:12}}update(t){const{axis:e,newDirection:i,smoothSpeed:s}=kt({behavior:this.behavior,distance:this.distance,direction:this.direction,x:this.x,y:this.y,orgX:this.orgX,orgY:this.orgY,dt:t});this.direction=i,this[e]+=this.speed*s[e],this.updateWaterBlur(t)}updateWaterBlur(t){this.phase<=-2?this.waveDir=1:this.phase>=2&&(this.waveDir=-1),this.phase+=t*this.waveDir*3}render(t){t&&(t.lineWidth=4,t.beginPath(),t.moveTo(this.x,this.y),t.quadraticCurveTo(this.x+2*this.phase,this.y+this.height/4+Math.abs(5*this.phase),this.x,this.y+this.height),t.moveTo(this.x+this.width,this.y),t.quadraticCurveTo(this.x+ +this.width+2*this.phase,this.y+this.height/4+Math.abs(5*this.phase),this.x+this.width,this.y+this.height),t.moveTo(this.x+this.phase/5,this.y),t.lineTo(this.x+this.phase/5+this.width,this.y),t.moveTo(this.x+this.phase/5,this.y+this.height),t.lineTo(this.x+this.phase/5+this.width,this.y+this.height),t.stroke())}}let St;const Lt=(...t)=>Bt(St,zzfxG(...t)),Bt=(t,...e)=>{let i=t.createBufferSource(),s=t.createBuffer(e.length,e[0].length,44100);return e.map(((t,e)=>s.getChannelData(e).set(t))),i.buffer=s,i.connect(t.destination),i.start(),i},Dt=(t,e,i,s=125)=>{let n,o,a,h,r,l,d,c,p,u,g,y,m,x,f,w=0,v=[],b=[],A=[],_=0,k=0,C=1,E={},S=window.zzfxR/s*60>>2;for(;C;_++)v=[C=c=g=m=0],i.map(((s,g)=>{for(d=e[s][_]||[0,0,0],C|=!!e[s][_],f=m+(e[s][0].length-2-!c)*S,x=g==i.length-1,o=2,h=m;o<d.length+x;c=++o){for(r=d[o],p=o==d.length+x-1&&x||u!=(d[0]||0)|r|0,a=0;a<S&&c;a++>S-99&&p&&(y+=(y<1)/99))l=(1-y)*v[w++]/2||0,b[h]=(b[h]||0)-l*k+l,A[h]=(A[h++]||0)+l*k+l;r&&(y=r%1,k=d[1]||0,(r|=0)&&(v=E[[u=d[w=0]||0,r]]=E[[u,r]]||(n=[...t[u]],n[2]*=2**((r-12)/12),r>0?window.zzfxG(...n):[])))}m=f}));return[b,A]};let Mt,It=!1,Nt=null,Rt=!1;const Pt=()=>{"undefined"!=typeof window&&(St=new(window.AudioContext||webkitAudioContext),window.zzfxR=44100,window.zzfxX=new(window.AudioContext||webkitAudioContext),window.zzfxG=(t=1,e=.05,i=220,s=0,n=0,o=.1,a=0,h=1,r=0,l=0,d=0,c=0,p=0,u=0,g=0,y=0,m=0,x=1,f=0,w=0)=>{let v,b,A=2*Math.PI,_=r*=500*A/44100**2,k=(0<g?1:-1)*A/4,C=i*=(1+2*e*Math.random()-e)*A/44100,E=[],S=0,L=0,B=0,D=1,M=0,I=0,N=0;for(l*=500*A/44100**3,g*=A/44100,d*=A/44100,c*=44100,p=44100*p|0,b=(s=99+44100*s)+(f*=44100)+(n*=44100)+(o*=44100)+(m*=44100)|0;B<b;E[B++]=N)++I%(100*y|0)||(N=a?1<a?2<a?3<a?Math.sin((S%A)**3):Math.max(Math.min(Math.tan(S),1),-1):1-(2*S/A%2+2)%2:1-4*Math.abs(Math.round(S/A)-S/A):Math.sin(S),N=(p?1-w+w*Math.sin(2*Math.PI*B/p):1)*(0<N?1:-1)*Math.abs(N)**h*t*.3*(B<s?B/s:B<s+f?1-(B-s)/f*(1-x):B<s+f+n?x:B<b-m?(b-B-m)/o*x:0),N=m?N/2+(m>B?0:(B<b-m?1:(b-B)/m)*E[B-m|0]/2):N),v=(i+=r+=l)*Math.sin(L*g-k),S+=v-v*u*(1-1e9*(Math.sin(B)+1)%2),L+=v-v*u*(1-1e9*(Math.sin(B)**2+1)%2),D&&++D>c&&(i+=d,C+=d,D=0),!p||++M%p||(i=C,r=_,D=D||1);return E}),"undefined"!=typeof window&&(Mt=window.zzfxX)},zt=()=>Rt,Ft=()=>{Rt=!1,Mt.suspend()},Xt=()=>{if(Rt=!0,Nt)return void Mt.resume();let t=Dt(...[[[.5,0,245,.07,.1,.65,,1.5,,,,,,,,,,,.05,1],[.3,0,245,,,3,2,.3,,-.001,,,,,,,.02,,,.04],[.1,0,245,,,2,1,0],[,0,,,,,4,,,,,,,,100,2]],[[[,,10,,,,17,,,,24,,,,25,,,,24,,,,17,,,,10,,,,17,,,,24,,,,25,,,,24,,,,17,,,,10,,,,17,,,,24,,,,25,,,,24,,,,17,,,,],[1,,22.1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,],[2,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,]],[[,,18,,,,22,,,,25,,,,29,,,,25,,,,22,,,,18,,,,22,,,,25,,,,29,,,,25,,,,22,,,,],[1,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,],[2,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,]],[[,,10,,,,17,,,,24,,,,25,,,,24,,,,17,,,,10,,,,17,,,,24,,,,25,,,,24,,,,17,,,,10,,,,17,,,,24,,,,25,,,,24,,,,17,,,,],[1,,25,,,,,,,,,,,,,,,,,,,,,,24,,25,,,,,,,,,,,,29,,,,,,,,,,,,28,,,,,,,,,,,,,,,,,,,,,,,,],[2,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,]],[[,,18,,,,22,,,,25,,,,29,,,,25,,,,22,,,,18,,,,22,,,,25,,,,29,,,,25,,,,22,,,,],[1,,18,,,,,,,,,,,,,,,,,,,,,,17,,18,,,,,,,,,,,,23,,,,,,,,,,,,],[2,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,]],[[,,10,,,,17,,,,24,,,,25,,,,24,,,,17,,,,10,,,,17,,,,24,,,,25,,,,24,,,,17,,,,10,,,,17,,,,24,,,,25,,,,24,,,,17,,,,],[1,,22,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,],[2,,10.53,,,,,,,,,,,,,,,,,,,,12.4,,,,13.7,,,,,,,,,,,,20,,,,,,,,,,,,18,,,,,,,,,,,,,,,,,,,,17,,,,]],[[,,18,,,,22,,,,25,,,,29,,,,25,,,,22,,,,18,,,,22,,,,25,,,,29,,,,25,,,,22,,,,],[1,,18,,,,,,,,,,,,,,,,,,,,,,17,,18,,,,,,,,,,,,23.1,,,,,,,,,,,,],[2,,6,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,-1]]],[0,1,2,3,4,5],,{title:"",instruments:["","","",""],patterns:["A1","A2","B1","B2","B3","B4"]}]);Nt=Bt(zzfxX,...t),Nt.loop=!0};let Tt=0,Yt=0;const Ot={};let jt={},Gt=!1;const Ut={},Vt=({id:t,data:e,img:i})=>{Ot[t]={data:e,img:i}},Wt=(t,e)=>!(!t||!e)&&(t.x<e.x+e.width&&t.x+t.width>e.x&&t.y<e.y+e.height&&t.height+t.y>e.y),Qt=(t,e)=>!!e.find((e=>e.token_id.split(":")[0]===t)),Jt=({x:t,y:e,scale:i,imgSrc:s})=>new Promise((n=>{const o=new Image;o.src=s,o.onload=()=>{const s=v({x:t,y:e,anchor:{x:.5,y:.5},width:8,height:8,image:o,scaleX:i,scaleY:i});n(s)}})),Kt=t=>new Promise((e=>{window.nearApi&&e();const i=document.createElement("script");i.onload=()=>{e()},i.src=t,document.head.appendChild(i)}));const Ht=()=>Kt("https://sdk.crazygames.com/crazygames-sdk-v1.js"),qt=t=>{const e=document.getElementById("hint");switch(e.textContent="",t){case 1:e.textContent='Reach the goal below. \nCut the rope with "S".';break;case 2:e.textContent='Use the arrow keys to move.\n Use "Space" to boost up.';break;case 3:e.textContent=""}};class Zt{level;scale=1;width=60;height=32;originalRadius={x:15,y:30};radiusX=15;radiusY=30;hasWon=!1;hasVanished=!1;vanishSpeed=.3;isVanishihng=!1;constructor(t,e,{level:i}){this.x=t,this.y=e,this.level=i}update(){this.hasVanished||this.checkCollision()}render(t){t&&!this.hasVanished&&(t.lineWidth=4,t.beginPath(),this.hasWon&&this.startVanishing(),t.ellipse(this.x+this.width/2,this.y+this.height/2,this.radiusX,this.radiusY,Math.PI/2,0,2*Math.PI),t.stroke())}startVanishing(){this.isVanishihng||Lt(...[,,269,.07,.21,.3,1,.94,8.3,-.2,284,.12,.12,,,,.13,.75,.17]),this.isVanishihng=!0,this.radiusX-=this.vanishSpeed,this.radiusY-=2*this.vanishSpeed,this.radiusX<=0&&(this.radiusX=0),this.radiusY<=0&&(this.radiusY=0),this.radiusX<=0&&this.radiusY<=0&&(this.hasVanished=!0,r("l"))}checkCollision(){if(Wt({x:this.x,y:this.y,width:this.width,height:this.height},this.level.player.sprite)){if(this.hasWon)return;r("g"),this.hasWon=!0}}}const $t={level1:{p:{x:400,y:255},r:30,s:[],b:[{x:272,y:220},{x:303,y:220},{x:333,y:220},{x:363,y:220},{x:393,y:220},{x:423,y:220},{x:453,y:220},{x:483,y:220},{x:453,y:300},{x:303,y:300}],g:[{x:370,y:600}]},level2:{p:{x:416,y:255},r:30,s:[],b:[{x:400,y:220},{x:302,y:360},{x:332,y:360},{x:462,y:360},{x:492,y:360}],g:[{x:388,y:86}]},level3:{p:{x:272,y:255},r:30,s:[{x:464,y:350,b:"ew",d:100}],b:[{x:260,y:220}],g:[{x:400,y:600}]},level4:{p:{x:416,y:155},r:30,s:[{x:416,y:374,b:"ew",d:70},{x:346,y:220}],b:[{x:400,y:120},{x:480,y:260},{x:480,y:290},{x:480,y:322},{x:480,y:354},{x:480,y:384},{x:480,y:414},{x:330,y:260},{x:330,y:290},{x:330,y:322},{x:330,y:354},{x:330,y:384},{x:330,y:414},{x:360,y:414},{x:390,y:414},{x:420,y:414},{x:450,y:414},{x:200,y:630,b:"ew",d:70}],g:[{x:200,y:690}]},level5:{p:{x:236,y:308,b:"ns",d:200},r:33,s:[{x:400,y:380},{x:400,y:480},{x:400,y:580}],b:[{x:220,y:275,b:"ns",d:200}],g:[{x:660,y:700}]},level6:{p:{x:272,y:255},r:30,s:[{x:300,y:400,b:"ew",d:100},{x:464,y:350,b:"ew",d:-200},{x:100,y:450,b:"ew",d:100}],b:[{x:260,y:220},{x:460,y:290},{x:460,y:322},{x:460,y:354}],g:[{x:600,y:700}]}};async function te(t){const e="https://api.arcadians.io/"+t;return new Promise(((i,s)=>{var n=new XMLHttpRequest;n.onload=()=>{if(n.readyState===n.DONE){200!==n.status&&s(null);let a="female";var e=JSON.parse(n.response);const h=e.attributes.find((t=>"Head"===t.trait_type));e.attributes.find((t=>"Class"===t.trait_type)).value.match("Male")&&(a="male");const r=h.value.toLowerCase().replaceAll(" ","-");var o=new Image;o.src=`https://nftstorage.link/ipfs/bafybeib2ir3zpgd3cmizcv7shekjeftcwq7apjib6i5gz2sjc4vajwtgiy/${a}/head/${r}.png`,o.addEventListener("error",(t=>{console.log("err",t),s(null)}),!1),o.addEventListener("load",(()=>{localStorage.setItem("Arcadian #"+t,o),Vt({id:t,data:e,img:o}),i({id:t,data:e,img:o})}),!1)}},n.open("GET",e),n.send()}))}const ee=["main","bonus","levels","level-dialog","near-levels","thanks"],ie=Object.keys($t).length;let se=!1,ne=!0;const oe=()=>{document.getElementById("select-level-btn").focus()},ae=({nftTokensBySeries:t,nftTokensForOwner:e,nftCollections:i})=>{const s=document.getElementById("loading-near-levels");s&&s.remove();const n=document.getElementById("near-levels-grid");i.forEach((t=>{var i,s;i=t.token_series_id,s=t.metadata.description,Ut[i]=s;const o=document.createElement("button"),a=document.createElement("img"),h=Qt(t.token_series_id,e);a.setAttribute("src","https://ipfs.fleek.co/ipfs/"+t.metadata.media),o.setAttribute("near","true"),h||o.classList.add("disabled"),o.setAttribute("token-series-id",t.token_series_id),o.setAttribute("price","1000000000000000000000000"),o.textContent=t.metadata.title,o.appendChild(a);const r=document.createElement("span");r.textContent=h?"Click to play level":"Buy level for: "+(t.price/Math.pow(10,24)).toFixed(2)+" Ⓝ",o.appendChild(r),o.classList.add("level-item"),n.appendChild(o)}))},he=()=>{const t=document.getElementById("bonus-grid");re(t),le(t)},re=e=>{const i=new Image;i.src=t("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAIBAMAAAA2IaO4AAAAAXNSR0IArs4c6QAAABJQTFRF9u3NAAAA6e%2FsoKCLVVVoIR4gJR%2FcEQAAAAJ0Uk5TAAB2k804AAAAK0lEQVR42mMQDA1lZBBVUgpkCFJSUmUIClUNZQgKVjWFcEWdVAIYBENDBQGBlgaUUfu3rwAAAABJRU5ErkJggg%3D%3D"),new Promise((t=>{const e=[];e.push(te(92)),e.push(te(101)),e.push(te(110)),e.push(te(104));for(let t=1;t<22;t++){if(2===t||13===t)continue;const i=te(t);e.push(i)}Promise.allSettled(e).then((e=>{t(e)}))})).then((t=>{for(let s=0;s<t.length;s++){if("fulfilled"!==t[s].status)continue;const n=t[s].value.img,o=document.createElement("canvas");o.setAttribute("height",4*n.height),o.setAttribute("width",4*n.width),o.classList.add("bonus-item"),o.setAttribute("arcadian",t[s].value.id),s>5&&!Gt&&o.classList.add("disabled");const a=o.getContext("2d");a.imageSmoothingEnabled=!1,a.scale(8,8),a.drawImage(i,n.width/4-4,n.height/4-12),a.scale(.5,.5),a.drawImage(n,0,0),e.appendChild(o)}}))},le=t=>{t.addEventListener("click",(t=>{var e;t.target.classList.contains("bonus-item")&&(t.target.classList.contains("disabled")||(e=t.target.getAttribute("arcadian"),jt=Ot[e],r("i",{img:jt.img}),ue("main")))}))},de=()=>{document.getElementById("wrap").addEventListener("click",ce)},ce=t=>{const e=t.target.id,i=t.target.classList;switch(e){case"select-level-btn":(()=>{const t=document.getElementById("levels-grid");t.innerHTML="";for(let e=1;e<ie+1;e++){const i=document.createElement("button");i.textContent=e,i.classList.add("level-item"),t.appendChild(i)}})(),ue("levels"),document.getElementsByClassName("level-item")[0].focus();break;case"bonus-content-btn":ue("bonus");break;case"hamburger":r("clickHamburger"),ue("main");break;case"near-level-btn":ue("near-levels");break;case"next-btn":ue(),r("x");break;case"replay-btn":ue(),r("r");break;case"music-btn":r("t")}if(i.contains("bone")||i.contains("inverse"))return void ue("main");const s=t.target.closest("button");s&&s.getAttribute("near")?pe(s):s&&s.classList.contains("level-item")&&(ue(),r("s",{levelId:+s.textContent}))},pe=t=>{if(t&&t.classList.contains("disabled")){Ae();r("b",{token_series_id:t.getAttribute("token-series-id"),priceInYoctoNear:t.getAttribute("price")})}else ue(),r("s",{levelData:JSON.parse((e=t.getAttribute("token-series-id"),Ut[e]))});var e},ue=t=>{ne=!!t,r("levelQuit",{}),qt(null),ee.forEach((e=>{const i=document.getElementById(e);i.classList.contains("hide")||i.classList.add("hide"),e===t&&i.classList.remove("hide")}))},ge=()=>{a("loginNear",ye),a("logoutNear",me)},ye=()=>{Ae()},me=()=>{const t=document.getElementById("near-level-btn");t.classList.add("disabled"),t.setAttribute("disabled","true")},xe=()=>{a("l",we),a("n",ve),a("p",be),a("t",fe)},fe=()=>{document.getElementById("music-btn").textContent=zt()?"Music is ON":"Music is OFF"},we=()=>{ue("level-dialog"),document.getElementById("next-btn").focus()},ve=({nftTokensBySeries:t,nftTokensForOwner:e,nftCollections:i})=>{ae({nftTokensBySeries:t,nftTokensForOwner:e,nftCollections:i})},be=()=>{if(se)return;const t=document.getElementById("coil-subscriber"),e=document.getElementById("coil-btn");e&&e.remove(),t&&t.classList.remove("hide");const i=document.getElementsByClassName("bonus-item");for(let t of i)t.classList.remove("disabled");i&&i.length&&(se=!0)},Ae=()=>{document.getElementById("loading-wrapper").classList.remove("hide")};class _e{player;constructor(t){this.player=t,this.initControls()}updateControls(){this.player.hasWon||this.player.isRopeCut||this.player.rope.length<=0||((yt("arrowleft")||yt("a")||H("dpadleft"))&&(this.player.applyForce(-1.5,-1),this.player.changePlayerDirection(!0)),(yt("arrowright")||yt("d")||H("dpadright"))&&(this.player.applyForce(1.5,-1),this.player.changePlayerDirection(!1)),(yt("space")||H("south"))&&this.player.applyForce(0,-5))}cutRope=()=>{this.player.rope.cutRope(Math.floor(this.player.rope.length/2))};initControls(){wt(["s"],this.cutRope),J("west",this.cutRope),wt(["z"],this.restartLevel)}restartLevel=()=>{r("r")};destroy=()=>{vt(["s"],this.cutRope),K("west",this.cutRope),vt(["z"],this.restartLevel)}}class ke{n1;n2;restingDistance=7;constructor(t,e){this.n1=t,this.n2=e}}class Ce{pos;oldPos;width=2;height=2;mass=.03;constructor({x:t,y:e}){this.pos=x(t,e),this.oldPos=x(t,e)}get x(){return this.pos.x}get y(){return this.pos.y}applyForce(t,e){this.pos.x+=t,this.pos.y+=e}}class Ee{nodes=[];links=[];anchor;iterations=20;constructor({x:t,y:e,numNodes:i,level:s}){this.level=s,this.anchor=x(t,e);for(let s=0;s<i;s++)this.nodes.push(new Ce({x:t,y:7*s+e}));for(let t=0;t<this.nodes.length-1;t++){const e=this.nodes[t],i=this.nodes[t+1];this.links.push(new ke(e,i))}}update(){this.updateNodes();for(let t=0;t<this.iterations;t++)this.updateLinks(),this.constrainNodes()}render(t){t&&this.renderRope(t)}updateNodes(){this.nodes.forEach((t=>{t===this.nodes[0]&&(t.pos=this.anchor);const e=t.pos.subtract(t.oldPos);t.oldPos=t.pos,t.pos=t.pos.add(e).add(x(0,9*t.mass))}))}constrainNodes(){this.nodes.forEach((t=>{t===this.nodes[0]&&(t.pos=this.anchor),this.handleWallCollision(t),this.handleBoxCollision(t)}))}updateLinks(){this.links.forEach((t=>{const e=t.n2.pos.subtract(t.n1.pos),i=e.length(),s=(t.restingDistance-i)/i/2,n=x(e.x*s,e.y*s);t.n1.pos=t.n1.pos.subtract(n),t.n2.pos=t.n2.pos.add(n)}))}renderRope(t){t.lineWidth=4,t.strokeStyle="#e9efec",t.beginPath(),this.links.forEach((e=>{t.moveTo(e.n1.x,e.n1.y),t.lineTo(e.n2.x,e.n2.y)})),t.stroke()}handleWallCollision(t){t.x>Tt&&(t.pos.x=Tt),t.x<0&&(t.pos.x=0),t.y>Yt&&(t.pos.y=Yt),t.y<0&&(t.pos.y=0)}handleBoxCollision(t,e){if(t===this.nodes[0])return;this.level.bricks.forEach((e=>{if(Wt(e,t)){const i=Math.abs(t.pos.x-e.x),s=Math.abs(t.pos.x-(e.x+e.width)),n=Math.abs(t.pos.y-e.y),o=Math.abs(t.pos.y-(e.y+e.height)),a=Math.max(i,s,n,o);a===s?t.pos.x=e.x-3:a===i?t.pos.x=e.x+e.width+3:a===o?t.pos.y=e.y-3:a===n&&(t.pos.y=e.y+e.height+3)}}))}cutRope(t){t>=this.nodes.length-1&&(t=this.nodes.length-2),this.links.splice(t,1),Lt(...[,,1081,.01,.01,.02,4,1.1,14,32,,,,.8,,,.06,.66]),r("c",{rope:this})}get length(){return this.nodes.length}get endNode(){return this.nodes[this.nodes.length-1]}get anchorNode(){return this.nodes.length?this.nodes[0]:{}}}class Se{timeBetweenBubbles=10;timeSinceLastBubble=10;timeSinceLastBoostBubble=10;constructor(){this.pool=At({create:v,maxSize:20})}render(){this.pool.render()}update(){this.timeSinceLastBubble+=1,this.timeSinceLastBoostBubble+=5,this.pool.update()}addBubbles({x:t,y:e,isBoost:i}){!i&&this.timeSinceLastBubble<=this.timeBetweenBubbles||i&&this.timeSinceLastBoostBubble<=this.timeBetweenBubbles||(Lt(...[,1,7,.02,.01,.02,4,.5,,,1,.01,,,150,,.21,,.01]),this.timeSinceLastBubble=0,this.timeSinceLastBoostBubble=0,this.pool.get({x:t/2,y:e/2,width:20,height:40,color:"#e9efec",ttl:50,render:function(){let t=8;i&&(t=4);const e=this.context;e.lineWidth=2,e.globalAlpha=this.ttl/60,e.strokeStyle=this.color,e.beginPath(),e.arc(this.x,this.y,t,0,2*Math.PI),e.stroke()},update:function(t){this.ttl-=1,this.x+=Math.random()>.5?1:-1,this.y-=1,i&&this.ttl>30?this.y+=2:i&&(this.y+=1.5)}}))}}class Le{game;rope=[];playerControls;scale=4;sprite={render:()=>{},x:0,y:0};headSprite={render:()=>{},x:0,y:0};hasWon=!1;hasSetListeners=!1;headImg;headOffset={x:10,y:38};isLeft=!1;isRopeCut=!1;anchorNodeSpeed=1;anchorNodeDirection;anchorNodeOrgPos;particleEffect;deadTimer=0;deadInAirTimer=0;deadLimit=50;deadInAirLimit=250;playerState="a";constructor({game:e,levelData:i}){i.p=i.p||{},this.levelData=i,this.anchorNodeDirection=Ct(i.p.b,i.p.d),this.distance=Math.abs(i.p.d),this.behavior=i.p.b,this.game=e;const s=i.r,n=i.p.x,o=i.p.y;this.anchorNodeOrgPos=x(n,o),this.headImg=jt.img||{width:0,height:0},this.createRope({startX:n,startY:o,ropeLength:s,levelData:i}),Jt({x:n,y:o,scale:this.scale,imgSrc:t("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAIBAMAAAA2IaO4AAAAAXNSR0IArs4c6QAAABJQTFRF9u3NAAAA6e%2FsoKCLVVVoIR4gJR%2FcEQAAAAJ0Uk5TAAB2k804AAAAK0lEQVR42mMQDA1lZBBVUgpkCFJSUmUIClUNZQgKVjWFcEWdVAIYBENDBQGBlgaUUfu3rwAAAABJRU5ErkJggg%3D%3D")}).then((t=>this.sprite=t)),this.createHeadSprite(this.headImg),this.playerControls=new _e(this),this.listenForGameEvents(),this.particleEffect=new Se}updateRope(){this.hasWon||this.rope.update()}renderRope(t){this.hasWon||this.rope.render(t)}createHeadSprite(t){if(!t.width||!t.height)return;const e=this.scale/2;let i=e;this.isLeft&&(i*=-1),this.headSprite=v({x:this.rope.endNode.x-t.width,y:this.rope.endNode.y-t.height,anchor:{x:.5,y:.5},width:8,height:8,image:t,scaleX:i,scaleY:e})}createRope({startX:t,startY:e,ropeLength:i}){this.rope=new Ee({x:t,y:e,numNodes:i,level:this.game.level}),this.isRopeCut=!1}renderPlayer(t){this.sprite.render(),this.headSprite.render()}applyForce(t,e){const i=e<-4;this.particleEffect.addBubbles({x:this.sprite.x,y:this.sprite.y,isBoost:i}),this.rope.endNode.applyForce(t,e)}changePlayerDirection(t){this.isLeft=t,t?(this.sprite.scaleX=-this.scale,this.headSprite.scaleX=-this.scale/2):(this.sprite.scaleX=this.scale,this.headSprite.scaleX=this.scale/2),this.headSprite.x=this.sprite.x-(this.headImg.width-this.headOffset.x)*Math.sign(this.sprite.scaleX)}render(t){this.renderRope(t),this.renderPlayer(t),this.particleEffect.render(t)}renderCollisionBox(t){t.lineWidth=4,t.strokeStyle="#e9efec",t.beginPath(),t.rect(this.sprite.x,this.sprite.y,this.sprite.width*this.scale,this.sprite.height*this.scale),t.stroke()}update(){this.sprite.x=this.rope.endNode.pos.x,this.sprite.y=this.rope.endNode.pos.y,this.headSprite.x=this.rope.endNode.pos.x-(this.headImg.width-this.headOffset.x)*Math.sign(this.sprite.scaleX),this.headSprite.y=this.rope.endNode.pos.y-this.headImg.height+ +this.headOffset.y,this.particleEffect.update(),this.updateRope(),this.updateAnchorNode(),this.handlePlayerState(),this.playerControls.updateControls()}handlePlayerState(){this.handleDeadOnGround(),this.handleDeadInAir()}handleDeadOnGround(){"d"!==this.playerState&&this.sprite.y>=Yt&&(this.deadTimer+=1,this.deadTimer>=this.deadLimit&&this.handleDied())}handleDeadInAir(){this.hasWon||this.isRopeCut&&"d"!==this.playerState&&(this.deadInAirTimer+=1,this.deadInAirTimer>=this.deadInAirLimit&&this.handleDied())}handleDied(){this.deadTimer=0,this.deadInAirTimer=0,this.playerState="d",r("d",{})}updateAnchorNode(){const t=this.rope.anchorNode,{axis:e,newDirection:i,smoothSpeed:s}=kt({behavior:this.behavior,distance:this.distance,direction:this.anchorNodeDirection,x:t.pos.x,y:t.pos.y,orgX:this.anchorNodeOrgPos.x,orgY:this.anchorNodeOrgPos.y});this.anchorNodeDirection=i,t.pos[e]+=this.anchorNodeSpeed*s[e]}reArrangeRope(){this.rope.splice(this.rope.length-2,1);const t=this.rope[this.rope.length-2];t&&(t.removeLink(),t.attachTo(this.pointMass))}respawnPlayer(){const t=this.levelData.r,e=this.levelData.p.x,i=this.levelData.p.y;this.anchorNodeDirection=Ct(this.levelData.p.b,this.levelData.p.d),this.createRope({startX:e,startY:i,ropeLength:t,levelData:this.levelData}),this.playerState="a"}listenForGameEvents(){this.hasSetListeners||(a("g",this.onGoalCollision),a("i",this.onArcadianAdded),a("c",this.onCutRope),this.hasSetListeners=!0)}onGoalCollision=()=>{this.hasWon=!0};onArcadianAdded=({img:t})=>{this.headImg=t,this.createHeadSprite(t)};onCutRope=({rope:t})=>{this.isRopeCut=!0};destroy=()=>{this.playerControls&&this.playerControls.destroy(),h("g",this.onGoalCollision),h("i",this.onArcadianAdded),h("c",this.onCutRope)};get currPos(){return this.rope.endNode.pos}get oldPos(){return this.rope.endNode.oldPos}set currPos(t){this.rope.endNode.currPos=t}set oldPos(t){this.rope.endNode.oldPos=t}}class Be{x;y;orgX;orgY;sprite={render:()=>{}};distance=100;speed=1;scale=4;rotSpeed=.2;width=8;height=8;level;constructor(e,i,{behavior:s,distance:n,level:o}){this.direction=Ct(s,n),this.distance=Math.abs(n),this.behavior=s,this.x=e,this.y=i,this.orgX=e,this.orgY=i,this.level=o,Jt({x:this.x,y:this.y,width:this.width,height:this.height,scale:this.scale,imgSrc:t("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAIBAMAAAA2IaO4AAAAAXNSR0IArs4c6QAAAA9QTFRFAAAA6e%2FsoKCLVVVoIR4gQ1uK0QAAAAF0Uk5TAEDm2GYAAAArSURBVHjaBcCBCQAQEADAIwMoCygT8AZQv%2F9OosB6iJjazW3cfGoE2oHuAz4SAw96QFa2AAAAAElFTkSuQmCC")}).then((t=>this.sprite=t))}update(){const{axis:t,newDirection:e,smoothSpeed:i}=kt({behavior:this.behavior,distance:this.distance,direction:this.direction,x:this.x,y:this.y,orgX:this.orgX,orgY:this.orgY});this.direction=e,this[t]+=this.speed*i[t],this.sprite.x=this.x,this.sprite.y=this.y,this.sprite.rotation+=this.rotSpeed}render(t){this.sprite.render()}}class De{player;saws=[];goals=[];bricks=[];isLevelLoaded=!1;isFirstRopeCut=!1;isStopMotion=!1;levelId;levelData;stopMotionTime=10;stopMotionEllapsed=0;constructor({game:t,levelId:e,levelData:i}){this.levelId=e,this.levelData=i,this.game=t,i?setTimeout((()=>{this.init(i)})):this.loadLevel("level"+e).then((t=>{this.init(t)})).catch((()=>{ue("thanks")})),this.listenForGameEvents()}init(t){this.levelData=t,this.createPlayer(t),this.createSaws(t),this.createGoals(t),this.createBricks(t),this.isLevelLoaded=!0,qt(this.levelId)}loadLevel(t){return new Promise(((e,i)=>{if($t[t]&&$t[t].p){e($t[t])}else i(null)}))}render(t){this.isLevelLoaded&&(this.saws.forEach((e=>{e.render(t)})),this.bricks.forEach((e=>{e.render(t)})),this.player.render(t),this.goals.forEach((e=>{e.render(t)})))}update(t){if(this.isLevelLoaded){if(this.isStopMotion)return this.stopMotionEllapsed+=1,void(this.stopMotionEllapsed>=this.stopMotionTime&&(this.isStopMotion=!1));this.checkCollisions(),this.player.update(t),this.saws.forEach((e=>{e.update(t)})),this.goals.forEach((e=>{e.update(t)})),this.bricks.forEach((e=>{e.update(t)}))}}createGoals(t){t.g.forEach((t=>{this.goals.push(new Zt(t.x,t.y,{level:this}))}))}createPlayer(t){this.player=new Le({levelData:t,game:this.game})}createSaws(t){t.s&&t.s.forEach((t=>{this.saws.push(new Be(t.x,t.y,{level:this,behavior:t.b,distance:t.d}))}))}createBricks(t){t.b&&t.b.forEach((t=>{this.bricks.push(new Et(t.x,t.y,{behavior:t.b,distance:t.d,level:this}))}))}listenForGameEvents(){a("d",this.onPlayerDied),a("l",this.onLevelComplete),a("c",this.onCutRope)}onCutRope=({rope:t})=>{this.isFirstRopeCut||(this.isStopMotion=!0,this.isFirstRopeCut=!0,this.flashScreen())};onLevelComplete=()=>{};flashScreen(){const t=document.getElementById("game-canvas");t.classList.add("flash"),setTimeout((()=>{requestAnimationFrame((()=>{t.classList.remove("flash")}))}),50)}onPlayerDied=({})=>{Lt(...[,,326,,.06,.08,1,.95,-6.8,,,,,,,,,.45,.08]),this.isFirstRopeCut=!1,this.stopMotionEllapsed=0,this.player.respawnPlayer(),this.resertSaws(),this.resetBricks()};resetBricks(){this.bricks.length=0,this.createBricks(this.levelData)}resertSaws(){this.saws.length=0,this.createSaws(this.levelData)}checkCollisions(){const t=this.player.rope;for(let e=0;e<t.length-2;e++)this.saws.forEach((i=>{Wt(t.nodes[e],{width:i.width*i.scale,height:i.height*i.scale,...i})&&this.player.rope.cutRope(e)}))}destroy(){h("d",this.onPlayerDied),h("l",this.onLevelComplete),h("c",this.onCutRope),this.player&&this.player.destroy()}}class Me{canvas;context;player;saw;level;isAdPlaying;deathCount;setDeathCount;constructor({deathCount:t,setDeathCount:e}){this.deathCount=t,this.setDeathCount=e;const i=this;let{canvas:s,context:n}=p();var o,a;n.textBaseline="middle",n.lineJoin="round",n.lineCap="round",n.imageSmoothingEnabled=!1,this.canvas=s,this.context=n,ft(),Pt(),o=s.height,Yt=o,a=s.width,Tt=a,X({update:function(t){i.isAdPlaying||i.level&&i.level.update(t)},render:function(){i.isAdPlaying||i.level&&(n.save(),i.level.render(n))}}).start(),this.listenForGameEvents()}loadLevel({levelId:t,levelData:e}){this.level&&this.level.destroy(),t?this.level=new De({levelId:t,game:this}):e&&(this.level=new De({game:this,levelData:e}))}listenForGameEvents(){a("x",this.onStartNextLevel),a("s",this.onStartLevel),a("r",this.onReStartLevel),a("t",this.onToggleMusic),a("levelQuit",this.onLevelQuit),a("adFinished",this.onAdFinished),a("adPlaying",this.onAdPlaying),a("d",this.onPlayerDead)}onPlayerDead=()=>{this.setDeathCount(++this.deathCount)};onAdPlaying=()=>{this.isAdPlaying=!0};onAdFinished=()=>{this.isAdPlaying=!1};onToggleMusic=()=>{Rt?(It=!1,Ft()):(It=!0,Xt())};onStartNextLevel=()=>{this.level.destroy(),this.level.levelId?this.loadLevel({levelId:this.level.levelId+1}):ue("near-levels")};onStartLevel=({levelId:t,levelData:e})=>{this.loadLevel({levelId:t,levelData:e})};onReStartLevel=()=>{this.loadLevel({levelId:this.level.levelId,levelData:this.level.levelData})};onLevelQuit=()=>{this.level&&this.level.destroy()}}const Ie=t=>{Gt=!0,r("p",t)},Ne=(t,e,i)=>{if(!ne)return;const s=document.activeElement.nextElementSibling;s&&s.focus()},Re=(t,e)=>{Ne()},Pe=(t,e)=>{Ne()},ze=({deathCount:t=0,setDeathCount:e=(()=>{})})=>{Fe(),new Me({deathCount:t,setDeathCount:e}),de(),xe(),ge(),he(),oe(),wt(["w","arrowup"],Re),J("dpadup",Re),wt(["s","arrowdown"],Pe),J("dpaddown",Pe),Ht().then((()=>{})),document&&document.monetization?document.monetization.addEventListener("monetizationprogress",(t=>Ie(t))):window.addEventListener("monetizationprogress",(t=>Ie(t)))},Fe=()=>{let e=document.createElement("style");e.textContent=t(':root{--bgc:#211e20;--bgc2:#555568;--fgc:#a0a08b;--fgc2:#e9efec;--acc:#e20fa0}body{width:100vw;height:100vh;background-color:var(--bgc);color:var(--fgc2);margin:0;padding:0;font-family:sans-serif;font-size:1em}#wrap{position:relative}body,#wrap{flex-flow:column;justify-content:center;align-items:center;display:flex}canvas{height:auto;max-width:90vw;max-height:90vh;background-color:var(--bgc)}#game-canvas{border:3px solid var(--fgc2)}.menu{color:var(--fgc2);flex-direction:row-reverse;align-content:center;align-items:center;padding:10px 20px;font-size:23px;font-weight:600;display:flex;position:absolute}#r-menu{top:0;right:0}#music-btn{margin-top:50px}.flat{background-color:inherit;color:var(--fgc2);border:3px solid var(--fgc2)}#hamburger{height:9px;cursor:pointer;flex-direction:column;align-items:center;line-height:.4;display:flex}#hint{white-space:pre-wrap;text-align:center;font-size:2vmin;position:absolute;bottom:5%}#hamburger,#hamburger:after,#hamburger:before{content:"––"}#hamburger:hover{filter:drop-shadow(0 0 12px var(--acc))}button,.btn{width:240px;height:50px;background-color:var(--fgc2);color:var(--bgc);cursor:pointer;border:none;border-radius:4px;margin-top:20px;font-size:16px;font-weight:600}button.disabled{color:#a9a9a9;cursor:not-allowed;background-color:#d3d3d3}button.disabled img{filter:contrast(.5)}button:hover,.btn:hover{background-color:var(--bgc2);color:var(--fgc2)}button:hover img{filter:none}#coil-subscriber{height:50px}#coil-btn{width:400px;height:50px;justify-content:center;align-items:center;text-decoration:none;display:flex}.overlay{width:100%;height:100%;background-color:var(--bgc);text-align:center;flex-direction:column;place-content:center;align-items:center;display:flex;position:absolute}#thanks{width:80%;height:80%}.level-item{cursor:pointer;aspect-ratio:1/1;width:60%;height:auto;max-height:70%;background-color:var(--fgc);border-radius:4px;flex-flow:column;justify-content:center;align-self:center;align-items:center;display:flex}.level-item img{width:100%;height:auto}.level-item img:not(.collected){filter:grayscale()}#levels-grid,#bonus-grid,#near-levels-grid{width:100%;height:100%;scroll-behavior:smooth;grid-template-columns:repeat(3,minmax(auto,150px));grid-auto-rows:minmax(120px,min-content);place-content:center;place-items:stretch center;display:grid;overflow-x:hidden;overflow-y:auto}#bonus-grid{align-content:stretch;row-gap:60px}#near-levels-grid{grid-template-columns:repeat(2,1fr)}#near-levels-grid .level-item{width:250px;height:300px;cursor:pointer;flex-flow:column}#bonus-grid{row-gap:0}#level-dialog{width:50%;height:50%;background-color:#121212ee;border:1px solid #fff;border-radius:4px}.bonus-item{cursor:pointer;background:0 0;border-radius:4px;margin-bottom:-60px}.bonus-item:hover:not(.disabled){transform:scale(1.1)}.bonus-item.disabled{filter:contrast(.5);cursor:not-allowed;background-color:#000}#bonus-grid>canvas{width:200px;height:200px;max-width:100%;max-height:100%;object-fit:contain}#loading-wrapper{z-index:99;background-color:#211e2055}#loading{border:16px solid var(--fgc2);border-top:16px solid var(--acc);width:120px;height:120px;border-radius:50%;animation:spin 2s linear infinite}@keyframes spin{0%{transform:rotate(0deg)}to{transform:rotate(360deg)}}.bone{cursor:pointer;cursor:pointer;font-size:32px;position:absolute;top:1%;right:1%}.bone:hover{filter:drop-shadow(0 0 12px var(--acc))brightness(1.3)}.inverse{position:absolute;top:-1px;left:-2px;transform:rotate(90deg)}.hide{display:none!important}.flash{background-color:var(--bgc2)}');document.getElementsByTagName("head")[0].appendChild(e)};export{ze as initGame};
//# sourceMappingURL=game.js.map
